function clearPassword(){hideElement(passwordCard),password.textContent=zeroVar(password.textContent),password.textContent="",setPasswordButton()}function trimDomainName(){var e=0;domainName.value=domainName.value.replace(/^https?:\/\//g,"").toLowerCase().trim(),e=domainName.value.indexOf("/"),e>0&&(domainName.value=domainName.value.substr(0,e))}function clearValues(){passPhrase.value=zeroVar(passPhrase.value),passPhrase.value="",passChangeRequiredCount=0,clearPassword()}function generatePassword(){hidePasswordToggle(),showElement(passwordCard),error.textContent=password.textContent="",setPasswordButton(),fullName=givenName.value.trim()+familyName.value.trim(),""===fullName||0===passPhrase.value.trim().length||"answer"===passwordType&&0===securityQuestion.value.trim().length||("answer"!==passwordType||0!==securityQuestion.value.trim().length)&&(passOff.userName="",passOff.securityQuestion="",passOff.fullName=fullName,passOff.passPhrase=passPhrase.value,passOff.domainName=domainName.value.trim(),userName.value.trim().length>0&&(passOff.userName=userName.value.trim()),"answer"===passwordType&&securityQuestion.value.trim().length>0&&(passOff.securityQuestion=securityQuestion.value.trim()),passwordType&&passOff.generatePassword(passwordType).then(function(e){clearBodyClasses(),"answer"===passwordType?bodyNode.classList.add("ext-answer-generated"):bodyNode.classList.add("ext-pass-generated"),password.textContent=e,hideElement(loaderPassword),populateOrCopyPassword(),setPassChangeRequired()})["catch"](function(e){error.textContent=e.message}))}function populateOrCopyPassword(){var e=!1;"undefined"!=typeof isChromeExtension?(generateExtPassword(),extHasPassword!==!0||"User name"===passwordCardHeader.textContent||"Answer"===passwordCardHeader.textContent?e=!0:(successToast.textContent=successPrefix+" inserted",window.setTimeout(function(){showToast(successToast,copyPasswordDiv)},250))):document.queryCommandSupported("copy")&&(e=!0),e&&(showElement(copyPasswordDiv),password.scrollIntoView(),window.setTimeout(function(){copyPasswordToClipboard()},200))}function setPassChangeRequired(){var e;passChangeRequiredCount=2,lastPassPhraseLength=passPhrase.value.length,lastPassGenTimeStamp=Date.now(),e=lastPassGenTimeStamp,window.setTimeout(function(){e===lastPassGenTimeStamp&&clearValues()},18e5)}function changePassPhrase(){clearPassword(),lastPassPhraseLength>0&&passChangeRequiredCount>0&&passPhrase.value.length<=lastPassPhraseLength?passChangeRequiredCount-=1:(0===lastPassPhraseLength||0===passChangeRequiredCount)&&showPasswordToggle()}function setPasswordButton(){var e=domainName.value.replace("https://","").replace("http://","").replace(/^www[\w-]*./g,"").trim().toLowerCase();("w"===e||"ww"===e||"www"===e)&&(e=""),(givenName.value.trim().length>0||familyName.value.trim().length>0)&&passPhrase.value.trim().length>0&&e.length>0&&("answer"!==passwordType||securityQuestion.value.trim().length>0)?generatePasswordButton.disabled=!1:generatePasswordButton.disabled=!0,hideElement(copyPasswordDiv)}function showElement(e){e.classList.remove("hidden")}function hideElement(e){e.classList.add("hidden")}function clearBodyClasses(){bodyNode.classList.remove("ext-pass"),bodyNode.classList.remove("ext-answer"),bodyNode.classList.remove("ext-pass-generated"),bodyNode.classList.remove("ext-answer-generated")}function copyPasswordToClipboard(){if(clipboardVal.value=password.textContent,clipboardVal.select(),document.queryCommandEnabled("copy"))try{document.execCommand("copy");successToast.textContent=successPrefix+" copied to Clipboard",showToast(successToast,copyPasswordDiv)}catch(e){console.log("Copy command failed")}else console.log("Copy command not enabled")}function clearClipboard(){if(clipboardVal.value="Value cleared",clipboardVal.select(),document.queryCommandSupported("copy"))try{document.execCommand("copy")}catch(e){console.log("Copy command failed")}else console.log("Copy command not enabled")}function chooseType(){setType(this.id)}function setType(e){switch(copyPasswordButton.textContent="Copy Password",successPrefix="Password",passwordCardHeader.textContent="Password",showElement(userNameDiv),hideElement(securityQuestionDiv),passwordType=e,e){case"login":generatePasswordButton.textContent="User name",copyPasswordButton.textContent="Copy User name",successPrefix="User name",passwordCardHeader.textContent="User name",hideElement(userNameDiv);break;case"maximum-password":generatePasswordButton.textContent="Produce Maximum Password";break;case"long-password":generatePasswordButton.textContent="Produce Long Password";break;case"medium-password":generatePasswordButton.textContent="Produce Medium Password";break;case"basic-password":generatePasswordButton.textContent="Produce Basic Password";break;case"short-password":generatePasswordButton.textContent="Produce Short Password";break;case"pin":generatePasswordButton.textContent="Produce Four Digit PIN",copyPasswordButton.textContent="Copy PIN",successPrefix="PIN",passwordCardHeader.textContent="PIN";break;case"pin-6":generatePasswordButton.textContent="Produce Six Digit PIN",copyPasswordButton.textContent="Copy PIN",successPrefix="PIN",passwordCardHeader.textContent="PIN";break;case"answer":generatePasswordButton.textContent="Produce Security Answer",copyPasswordButton.textContent="Copy Security Answer",successPrefix="Answer",passwordCardHeader.textContent="Answer",showElement(securityQuestionDiv)}clearBodyClasses(),"answer"===passwordType?bodyNode.classList.add("ext-answer"):bodyNode.classList.add("ext-pass"),clearPassword()}function showPasswordToggle(){0===passChangeRequiredCount&&showElement(passwordToggle)}function hidePasswordToggle(){hideElement(passwordToggle),passPhrase.type="password"}function togglePasswordView(){"password"===passPhrase.type?passPhrase.type="text-area":passPhrase.type="password",passPhrase.focus()}function runTests(){"undefined"!=typeof isChromeExtension?window.open("https://mrpeel.github.io/opensesame/test/opensesame-test.html"):window.open("test/opensesame-test.html")}function showToast(e,t){hideElement(t),showElement(e),e.scrollIntoView(),window.setTimeout(function(){hideToast(e,t)},5200)}function hideToast(e,t){showElement(t),hideElement(e)}function PBKDF2(e,t,s,r){"use strict";if(window.crypto&&window.crypto.subtle){var a=new TextEncoder("utf-8"),n=a.encode(t),o=a.encode(e);return window.crypto.subtle.importKey("raw",o,{name:"PBKDF2"},!1,["deriveBits"]).then(function(e){return window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:s,salt:n,hash:"SHA-1"},e,r)})}return new Promise(function(a,n){var o=CryptoJS.PBKDF2(e,t,{iterations:s,keySize:r/32});a(o)})}function HMACSHA256(e,t){"use strict";return window.crypto&&window.crypto.subtle?new Promise(function(s,r){var a=new TextEncoder("utf-8"),n=a.encode(e);window.crypto.subtle.importKey("raw",t,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]).then(function(e){return window.crypto.subtle.sign({name:"HMAC",hash:{name:"SHA-256"}},e,n)}).then(function(e){var t=new Uint8Array(e);s(t)})}):new Promise(function(s,r){var a=CryptoJS.HmacSHA256(e,t),n=convertWordArrayToUint8Array(a);s(n)})}function aesEncrypt(e,t){"use strict";return window.crypto&&window.crypto.subtle?new Promise(function(s,r){var a=new TextEncoder("utf-8"),n=a.encode(e),o=convertHexToUint8Array(t),c=window.crypto.getRandomValues(new Uint8Array(16));window.crypto.subtle.importKey("raw",o,{name:"AES-CBC",length:128},!1,["encrypt"]).then(function(e){return window.crypto.subtle.encrypt({name:"AES-CBC",iv:c},e,n)}).then(function(e){var t=new Uint8Array(e);s({iv:c,ciphertext:t})})}):new Promise(function(s,r){var a=CryptoJS.AES.encrypt(e,t);s(a)})}function aesDecrypt(e,t){"use strict";return window.crypto&&window.crypto.subtle?new Promise(function(s,r){var a=(new TextEncoder("utf-8"),new TextDecoder("utf-8")),n=convertHexToUint8Array(t);window.crypto.subtle.importKey("raw",n,{name:"AES-CBC",length:128},!1,["decrypt"]).then(function(t){return window.crypto.subtle.decrypt({name:"AES-CBC",iv:e.iv},t,e.ciphertext)}).then(function(e){var t=new Uint8Array(e),r=a.decode(t);s(r)})}):new Promise(function(s,r){var a=CryptoJS.AES.decrypt(e,t),n=CryptoJS.enc.Utf8.stringify(a);s(n)})}function convertDerivedKeyToHex(e){"use strict";return convertUint8ArrayToHex(window.crypto&&window.crypto.subtle?new Uint8Array(e):convertWordArrayToUint8Array(e))}function convertWordArrayToHex(e){"use strict";return convertUint8ArrayToHex(convertWordArrayToUint8Array(e))}function convertWordArrayToUint8Array(e){"use strict";for(var t=e.words,s=e.sigBytes,r=new Uint8Array(s),a=0;s>a;a++){var n=t[a>>>2]>>>24-a%4*8&255;r[a]=n}return r}function convertUint8ArrayToHex(e){var t,s,r,a="";for(t=0,s=e.length;s>t;t+=1)r=e[t].toString(16),r.length<2&&(r="0"+r),a+=r;return a}function convertHexToUint8Array(e){var t,s,r=e.length/2,a=0;if(r!==parseInt(r,10))throw new Error("Invalid hex length '"+e.length+"'");for(s=new Uint8Array(r),t=0;r>t;t+=1)s[t]=parseInt(e[a]+e[a+1],16),a+=2;return s}function zeroVar(e){return Array(e.length).join("0")}function zeroIntArray(e){for(var t=e,s=0;s<e.length;s++)t[s]=0;return t}var PassOff=function(){"use strict";this.keyNS="cake.man.passoff",this.passwordNS="cake.man.passoff.password",this.loginNS="cake.man.passoff.login",this.answerNS="cake.man.passoff.answer",this.fullName="",this.passPhrase="",this.domainName="",this.userName="",this.securityQuestion="",this.templates={"maximum-password":["anoxxxxxxxxxxxxxxxxx","axxxxxxxxxxxxxxxxxno"],"long-password":["CvcvnoCvcvCvcv","CvcvCvcvnoCvcv","CvcvCvcvCvcvno","CvccnoCvcvCvcv","CvccCvcvnoCvcv","CvccCvcvCvcvno","CvcvnoCvccCvcv","CvcvCvccnoCvcv","CvcvCvccCvcvno","CvcvnoCvcvCvcc","CvcvCvcvnoCvcc","CvcvCvcvCvccno","CvccnoCvccCvcv","CvccCvccnoCvcv","CvccCvccCvcvno","CvcvnoCvccCvcc","CvcvCvccnoCvcc","CvcvCvccCvccno","CvccnoCvcvCvcc","CvccCvcvnoCvcc","CvccCvcvCvccno"],"medium-password":["CvcnoCvc","CvcCvcno"],"basic-password":["aaanaaan","aannaaan","aaannaaa"],"short-password":["Cvcn"],pin:["nnnn"],"pin-6":["nnnnnn"],login:["cvccvcvcv"],answer:["cvcc cvc cvccvcv cvc","cvc cvccvcvcv cvcv","cv cvccv cvc cvcvccv"]},this.passchars={V:"AEIOU",C:"BCDFGHJKLMNPQRSTVWXYZ",v:"aeiou",c:"bcdfghjklmnpqrstvwxyz",A:"AEIOUBCDFGHJKLMNPQRSTVWXYZ",a:"AEIOUaeiouBCDFGHJKLMNPQRSTVWXYZbcdfghjklmnpqrstvwxyz",n:"0123456789",o:"@&%?,=[]_:-+*$#!'^~;()/.",x:"AEIOUaeiouBCDFGHJKLMNPQRSTVWXYZbcdfghjklmnpqrstvwxyz0123456789!@#$%^&*()"," ":" "},this.countryTLDs=["ac","ad","ae","af","ag","ai","al","am","an","ao","aq","ar","as","at","au","aw","ax","az","ba","bb","bd","be","bf","bg","bh","bi","bj","bm","bn","bo","br","bs","bt","bv","bw","by","bz","ca","cc","cd","cf","cg","ch","ci","ck","cl","cm","cn","co","cr","cs","cu","cv","cw","cx","cy","cz","dd","de","dj","dk","dm","do","dz","ec","ee","eg","eh","er","es","et","eu","fi","fj","fk","fm","fo","fr","ga","gb","gd","ge","gf","gg","gh","gi","gl","gm","gn","gp","gq","gr","gs","gt","gu","gw","gy","hk","hm","hn","hr","ht","hu","id","ie","il","im","in","iq","ir","is","it","je","jm","jo","jp","ke","kg","kh","ki","km","kn","kp","kr","kw","ky","kz","la","lb","lc","li","lk","lr","ls","lt","lu","lv","ly","ma","mc","md","me","mg","mh","mk","ml","mm","mn","mo","mp","mq","mr","ms","mt","mu","mv","mw","mx","my","mz","na","nc","ne","nf","ng","ni","nl","no","np","nr","nu","nz","om","pa","pe","pf","pg","ph","pk","pl","pm","pn","pr","ps","pt","pw","py","qa","re","ro","rs","ru","rw","sa","sb","sc","sd","se","sg","sh","si","sj","sk","sl","sm","sn","so","sr","ss","st","su","sv","sx","sy","sz","tc","td","tf","tg","th","tj","tk","tl","tm","tn","to","tp","tr","tt","tv","tw","tz","ua","ug","uk","us","uy","uz","va","vc","ve","vg","vi","vn","vu","wf","ws","ye","yt","yu","za","zm","zw"]};PassOff.prototype.clearPassPhrase=function(){"use strict";this.passPhrase=zeroVar(this.passPhrase),this.passPhrase=""},PassOff.prototype.generatePassword=function(e){"use strict";var t;performance.now();if(0===this.fullName.length)return Promise.reject(new Error("Name not present"));if(0===this.passPhrase.length)return Promise.reject(new Error("Passphrase not present"));if(0===this.domainName.length)return Promise.reject(new Error("Domain name not present"));if("answer"===e&&0===this.securityQuestion.length)return Promise.reject(new Error("Security question not present"));try{var s=this;return new Promise(function(r,a){t=s.passwordNS,"answer"===e?t=s.answerNS:"login"==e&&(t=s.loginNS);var n,o=s.fullName.trim().toLowerCase(),c=t+"."+o,i=s.userName.trim().toLowerCase(),d=0,u="",p=s.domainName.replace(/^https?:\/\//g,"").toLowerCase();d=p.indexOf("/"),d>0&&(p=p.substr(0,d)),n=p.split("."),n.length>1&&s.countryTLDs.indexOf(n[n.length-1])>=0&&(u="."+n[n.length-1],n=n.slice(0,-1)),n.length>2&&(n=n.slice(-2)),p=n.join(".")+u;var l="";return i&&i.length>0&&(p=i+"@"+p),"answer"===e&&(l=s.securityQuestion.replace(/[.,-\/#!$%\^&\*;:{}=\-_`~()?'"]/g,"").replace(/  +/g," ").trim().toLowerCase(),p=p+":"+l),PBKDF2(s.passPhrase,c,750,128).then(function(e){return HMACSHA256(p,e)}).then(function(t){for(var a=s.templates[e],n=a[t[0]%a.length],o=n.split("").map(function(e,r){var a=s.passchars[e];return a[t[r+1]%a.length]}).join(""),c=0;c<t.length;c++)t[c]=0;s.clearPassPhrase(),r(o)})["catch"](function(e){return Promise.reject(e)})})}catch(r){return Promise.reject(r)}};var givenName,familyName,passPhrase,domainName,securityQuestion,securityQuestionDiv,userName,userNameDiv,type,resultType,generatePasswordButton,password,passwordCard,passwordCardHeader,copyPasswordDiv,loaderPassword,closePasswordButton,copyPasswordButton,bodyNode,clipboardVal,passwordToggle,headerKey,successToast,lastPassGenTimeStamp,successPrefix,passOff,passwordType,fullName,error,passChangeRequiredCount,lastPassPhraseLength;window.addEventListener("load",function(){window.applicationCache.addEventListener("updateready",function(e){window.applicationCache.status==window.applicationCache.UPDATEREADY&&window.location.reload()},!1),passOff=new PassOff,headerKey=document.querySelector("[id=header-key]"),givenName=document.querySelector("[id=given-name]"),familyName=document.querySelector("[id=family-name]"),passPhrase=document.querySelector("[id=passphrase]"),passwordToggle=document.querySelector("[id=show-password]"),generatePasswordButton=document.querySelector("[id=generate-password]"),domainName=document.querySelector("[id=domain]"),securityQuestion=document.querySelector("[id=security-question]"),securityQuestionDiv=document.querySelector("[id=security-question-div]"),userName=document.querySelector("[id=user-name]"),userNameDiv=document.querySelector("[id=user-name-div]"),type=document.querySelector("[id=type]"),passwordCard=document.querySelector("[id=password-card]"),passwordCardHeader=document.querySelector("[id=password-card-header]"),password=document.querySelector(".password"),clipboardVal=document.querySelector("[id=clipboard-value]"),error=document.querySelector(".error"),successToast=document.querySelector("[id=success-toast]"),copyPasswordButton=document.querySelector("[id=copy-password]"),copyPasswordDiv=document.querySelector("[id=copy-password-div]"),loaderPassword=document.querySelector("[id=load-bar-ball]"),closePasswordButton=document.querySelector("[id=close-password]"),bodyNode=document.querySelector("body"),givenName.disabled=familyName.disabled=passPhrase.disabled=domainName.disabled=userName.disabled=type.disabled=!1,givenName.addEventListener("input",clearPassword,!1),givenName.addEventListener("focus",hidePasswordToggle,!1),givenName.addEventListener("focusin",hidePasswordToggle,!1),familyName.addEventListener("input",clearPassword,!1),familyName.addEventListener("focus",hidePasswordToggle,!1),familyName.addEventListener("focusin",hidePasswordToggle,!1),passPhrase.addEventListener("input",changePassPhrase,!1),passPhrase.addEventListener("focus",showPasswordToggle,!1),passPhrase.addEventListener("focusin",showPasswordToggle,!1),securityQuestion.addEventListener("input",clearPassword,!1),securityQuestion.addEventListener("focus",hidePasswordToggle,!1),securityQuestion.addEventListener("focusin",hidePasswordToggle,!1),domainName.addEventListener("input",clearPassword,!1),domainName.addEventListener("focus",hidePasswordToggle,!1),domainName.addEventListener("focusin",hidePasswordToggle,!1),domainName.addEventListener("focusout",trimDomainName,!1),domainName.addEventListener("blur",trimDomainName,!1),userName.addEventListener("input",clearPassword,!1),userName.addEventListener("focus",hidePasswordToggle,!1),userName.addEventListener("focusin",hidePasswordToggle,!1);for(var e=0;e<type.children.length;e++)type.children[e].addEventListener("click",chooseType,!1);passChangeRequiredCount=0,lastPassPhraseLength=0,void 0===passwordType&&setType("long-password"),headerKey.addEventListener("click",runTests,!1),generatePasswordButton.addEventListener("click",generatePassword,!1),passwordToggle.addEventListener("click",togglePasswordView,!1),copyPasswordButton.addEventListener("click",copyPasswordToClipboard,!1),closePasswordButton.addEventListener("click",clearPassword,!1),givenName.focus()},!1),window.PBKDF2=PBKDF2,window.HMACSHA256=HMACSHA256,window.aesEncrypt=aesEncrypt,window.aesDecrypt=aesDecrypt,window.convertDerivedKeyToHex=convertDerivedKeyToHex,window.convertWordArrayToHex=convertWordArrayToHex,window.convertWordArrayToUint8Array=convertWordArrayToUint8Array,window.convertUint8ArrayToHex=convertUint8ArrayToHex,window.convertHexToUint8Array=convertHexToUint8Array,window.zeroVar=zeroVar,window.zeroIntArray=zeroIntArray;var TemporaryPhraseStore=function(){this.ns="cake.man.io"};TemporaryPhraseStore.prototype.encryptPhrase=function(e,t){"use strict";var s,r=this;return new Promise(function(a,n){if("string"==typeof e&&e.length>=3){var o=e.substring(0,3);PBKDF2(t+o,t+r.ns,500,128).then(function(e){return s=convertDerivedKeyToHex(e),PBKDF2(convertDerivedKeyToHex(e),t+o,250,128)}).then(function(t){return r.threeCharHash=convertDerivedKeyToHex(t),aesEncrypt(e,s)}).then(function(e){r.encData=e,a("Success")})["catch"](function(e){n(e)})}else n("Pass phrase must be a sring at least three characters long")})},TemporaryPhraseStore.prototype.decryptPhrase=function(e,t){"use strict";var s,r=this;return new Promise(function(a,n){"undefined"==typeof r.encData?n("No encrypted data found"):"string"!=typeof e||3!==e.length?(delete r.encData,delete r.threeCharHash,n("First three characters parameter is not a 3 character string")):PBKDF2(t+e,t+r.ns,500,128).then(function(r){return s=convertDerivedKeyToHex(r),PBKDF2(convertDerivedKeyToHex(r),t+e,250,128)}).then(function(e){r.threeCharHash===convertDerivedKeyToHex(e)?aesDecrypt(r.encData,s).then(function(e){a(e)}):(zeroVar(r.threeCharHash),r.threeCharHash="","string"==typeof r.encData.iv?(zeroVar(r.encData.iv),r.encData.iv=""):"Uint8Array"===r.encData.iv.constructor.name&&(zeroIntArray(r.encData.iv),r.encData.iv=[]),"string"==typeof r.encData.ciphertext?(zeroVar(r.encData.ciphertext),r.encData.ciphertext=""):"Uint8Array"===r.encData.ciphertext.constructor.name&&(zeroIntArray(r.encData.ciphertext),r.encData.ciphertext=[]),delete r.encData,delete r.threeCharHash,n("First three characters did not match"))})})};
//# sourceMappingURL=opensesame.min.js.map