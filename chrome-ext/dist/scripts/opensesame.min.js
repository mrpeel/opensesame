let OpenSesame=function(){"use strict";this.keyNS="cake.man.opensesame",this.passwordNS="cake.man.opensesame.password",this.loginNS="cake.man.opensesame.login",this.answerNS="cake.man.opensesame.answer",this.lowerChars="abcdefghijklmnopqrstuvwxyz",this.upperChars="ABCDEFGHIJKLMNOPQRSTUVWXYZ",this.numberChars="0123456789",this.symbolChars="!@#$%^&*()",this.passwordTypes={"maximum-password":{charSet:this.upperChars+this.lowerChars+this.numberChars+this.symbolChars,length:20,needsUpper:!0,needsLower:!0,needsNumber:!0,needsSymbol:!0},"long-password":{charSet:this.upperChars+this.lowerChars+this.numberChars+this.symbolChars,length:14,needsUpper:!0,needsLower:!0,needsNumber:!0,needsSymbol:!0},"medium-password":{charSet:this.upperChars+this.lowerChars+this.numberChars+this.symbolChars,length:8,needsUpper:!0,needsLower:!0,needsNumber:!0,needsSymbol:!0},"basic-password":{charSet:this.upperChars+this.lowerChars+this.numberChars,length:8,needsUpper:!0,needsLower:!0,needsNumber:!0},"short-password":{charSet:this.upperChars+this.lowerChars+this.numberChars,length:4,needsUpper:!0,needsLower:!0,needsNumber:!0},pin:{charSet:this.numberChars,length:4},"pin-6":{charSet:this.numberChars,length:6},answer:{charSet:this.lowerChars,length:16,spaces:[3,6,12]}},this.countryTLDs=["ac","ad","ae","af","ag","ai","al","am","an","ao","aq","ar","as","at","au","aw","ax","az","ba","bb","bd","be","bf","bg","bh","bi","bj","bm","bn","bo","br","bs","bt","bv","bw","by","bz","ca","cc","cd","cf","cg","ch","ci","ck","cl","cm","cn","co","cr","cs","cu","cv","cw","cx","cy","cz","dd","de","dj","dk","dm","do","dz","ec","ee","eg","eh","er","es","et","eu","fi","fj","fk","fm","fo","fr","ga","gb","gd","ge","gf","gg","gh","gi","gl","gm","gn","gp","gq","gr","gs","gt","gu","gw","gy","hk","hm","hn","hr","ht","hu","id","ie","il","im","in","iq","ir","is","it","je","jm","jo","jp","ke","kg","kh","ki","km","kn","kp","kr","kw","ky","kz","la","lb","lc","li","lk","lr","ls","lt","lu","lv","ly","ma","mc","md","me","mg","mh","mk","ml","mm","mn","mo","mp","mq","mr","ms","mt","mu","mv","mw","mx","my","mz","na","nc","ne","nf","ng","ni","nl","no","np","nr","nu","nz","om","pa","pe","pf","pg","ph","pk","pl","pm","pn","pr","ps","pt","pw","py","qa","re","ro","rs","ru","rw","sa","sb","sc","sd","se","sg","sh","si","sj","sk","sl","sm","sn","so","sr","ss","st","su","sv","sx","sy","sz","tc","td","tf","tg","th","tj","tk","tl","tm","tn","to","tp","tr","tt","tv","tw","tz","ua","ug","uk","us","uy","uz","va","vc","ve","vg","vi","vn","vu","wf","ws","ye","yt","yu","za","zm","zw"]};OpenSesame.prototype.generatePassword=function(userName,passPhrase,domainName,passwordType,vers,securityQuestion){"use strict";let passNS="",version=vers||1,securityQuestionValue=securityQuestion||"";if(0===passPhrase.length)return Promise.reject(new Error("Passphrase not present"));if(0===domainName.length)return Promise.reject(new Error("Domain name not present"));if(0===userName.length)return Promise.reject(new Error("Domain name not present"));if("answer"===passwordType&&0===securityQuestion.length)return Promise.reject(new Error("Security question not present"));try{let openSesame=this;return new Promise(function(resolve,reject){passNS=openSesame.passwordNS,"answer"===passwordType?passNS=openSesame.answerNS:"login"==passwordType&&(passNS=openSesame.loginNS);let domainParts,userNameValue=userName.trim().toLowerCase(),salt=passNS+"."+userNameValue,posDomain=0,calculatedDomain="",domainCountryCode="",fullDomain=domainName.replace(/^https?:\/\//g,"").toLowerCase();return posDomain=fullDomain.indexOf("/"),posDomain>0&&(fullDomain=fullDomain.substr(0,posDomain)),domainParts=fullDomain.split("."),domainParts.length>1&&openSesame.countryTLDs.indexOf(domainParts[domainParts.length-1])>=0&&(domainCountryCode="."+domainParts[domainParts.length-1],domainParts=domainParts.slice(0,-1)),domainParts.length>2&&(domainParts=domainParts.slice(-2)),calculatedDomain=domainParts.join(".")+domainCountryCode,calculatedDomain=userNameValue+version+"@"+calculatedDomain,"answer"===passwordType&&(securityQuestionValue=securityQuestionValue.replace(/[.,-\/#!$%\^&\*;:{}=\-_`~()?'']/g,"").replace(/  +/g," ").trim().toLowerCase(),calculatedDomain=calculatedDomain+":"+securityQuestionValue),pBKDF2(openSesame.passPhrase,salt,750,128).then(function(key){return hMACSHA256(calculatedDomain,key)}).then(function(seedArray){let passLength=openSesame.passwordTypes[passwordType].length,passAdjLength=passLength-1,spaces=openSesame.passwordTypes[passwordType].spaces||[],charSet=openSesame.passwordTypes[passwordType].charSet,password="",needsUpper=openSesame.passwordTypes[passwordType].needsUpper||!1,needsLower=openSesame.passwordTypes[passwordType].needsLower||!1,needsNumber=openSesame.passwordTypes[passwordType].needsNumber||!1,needsSymbol=openSesame.passwordTypes[passwordType].needsSymbol||!1,upperCheck=seedArray[0]%passAdjLength,lowerCheck=upperCheck+1,numberCheck=upperCheck+2,symbolCheck=upperCheck+3;for(let s=0;s<seedArray.length;s++){let newChar;s<passLength&&(newChar=spaces.indexOf[s]>=0?" ":needsUpper&&s===upperCheck%passAdjLength?openSesame.upperChars[seedArray[s]%(openSesame.upperChars.length-1)]:needsLower&&s===lowerCheck%passAdjLength?openSesame.lowerChars[seedArray[s]%(openSesame.lowerChars.length-1)]:needsNumber&&s===numberCheck%passAdjLength?openSesame.numberChars[seedArray[s]%(openSesame.lowerChars.length-1)]:needsSymbol&&s===symbolCheck%passAdjLength?openSesame.symbolChars[seedArray[s]%(openSesame.lowerChars.length-1)]:charSet[seedArray[s]%(charSet.length-1)],password+=newChar,openSesame.upperChars.indexOf(newChar)>=0?needsUpper=!1:openSesame.lowerChars.indexOf(newChar)>=0?needsLower=!1:openSesame.numberChars.indexOf(newChar)>=0?needsNumber=!1:openSesame.symbolChars.indexOf(newChar)>=0&&(needsSymbol=!1)),seedArray[s]=0}passPhrase=zeroVar(passPhrase),resolve(password)}).catch(function(e){return Promise.reject(e)})})}catch(e){return Promise.reject(e)}};