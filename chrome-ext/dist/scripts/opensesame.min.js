let OpenSesame=function(){"use strict";this.keyNS="cake.man.opensesame",this.passwordNS="cake.man.opensesame.password",this.loginNS="cake.man.opensesame.login",this.answerNS="cake.man.opensesame.answer",this.passwordTypes={"maximum-password":{charSet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()",length:20},"long-password":{charSet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()",length:14},"medium-password":{charSet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()",length:8},"basic-password":{charSet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",length:8},"short-password":{charSet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()",length:4},pin:{charSet:"0123456789",length:4},"pin-6":{charSet:"0123456789",length:6},login:{charSet:"abcdefghijklmnopqrstuvwxyz0123456789",length:9},answer:{charSet:"abcdefghijklmnopqrstuvwxyz",length:16,spaces:[3,6,12]}},this.countryTLDs=["ac","ad","ae","af","ag","ai","al","am","an","ao","aq","ar","as","at","au","aw","ax","az","ba","bb","bd","be","bf","bg","bh","bi","bj","bm","bn","bo","br","bs","bt","bv","bw","by","bz","ca","cc","cd","cf","cg","ch","ci","ck","cl","cm","cn","co","cr","cs","cu","cv","cw","cx","cy","cz","dd","de","dj","dk","dm","do","dz","ec","ee","eg","eh","er","es","et","eu","fi","fj","fk","fm","fo","fr","ga","gb","gd","ge","gf","gg","gh","gi","gl","gm","gn","gp","gq","gr","gs","gt","gu","gw","gy","hk","hm","hn","hr","ht","hu","id","ie","il","im","in","iq","ir","is","it","je","jm","jo","jp","ke","kg","kh","ki","km","kn","kp","kr","kw","ky","kz","la","lb","lc","li","lk","lr","ls","lt","lu","lv","ly","ma","mc","md","me","mg","mh","mk","ml","mm","mn","mo","mp","mq","mr","ms","mt","mu","mv","mw","mx","my","mz","na","nc","ne","nf","ng","ni","nl","no","np","nr","nu","nz","om","pa","pe","pf","pg","ph","pk","pl","pm","pn","pr","ps","pt","pw","py","qa","re","ro","rs","ru","rw","sa","sb","sc","sd","se","sg","sh","si","sj","sk","sl","sm","sn","so","sr","ss","st","su","sv","sx","sy","sz","tc","td","tf","tg","th","tj","tk","tl","tm","tn","to","tp","tr","tt","tv","tw","tz","ua","ug","uk","us","uy","uz","va","vc","ve","vg","vi","vn","vu","wf","ws","ye","yt","yu","za","zm","zw"]};OpenSesame.prototype.generatePassword=function(userName,passPhrase,domainName,passwordType,vers,securityQuestion){"use strict";let passNS="",version=vers||1,securityQuestionValue=securityQuestion||"";if(0===passPhrase.length)return Promise.reject(new Error("Passphrase not present"));if(0===domainName.length)return Promise.reject(new Error("Domain name not present"));if(0===userName.length)return Promise.reject(new Error("Domain name not present"));if("answer"===passwordType&&0===securityQuestion.length)return Promise.reject(new Error("Security question not present"));try{let openSesame=this;return new Promise(function(resolve,reject){passNS=openSesame.passwordNS,"answer"===passwordType?passNS=openSesame.answerNS:"login"==passwordType&&(passNS=openSesame.loginNS);let domainParts,userNameValue=userName.trim().toLowerCase(),salt=passNS+"."+userNameValue,posDomain=0,calculatedDomain="",domainCountryCode="",fullDomain=domainName.replace(/^https?:\/\//g,"").toLowerCase();return posDomain=fullDomain.indexOf("/"),posDomain>0&&(fullDomain=fullDomain.substr(0,posDomain)),domainParts=fullDomain.split("."),domainParts.length>1&&openSesame.countryTLDs.indexOf(domainParts[domainParts.length-1])>=0&&(domainCountryCode="."+domainParts[domainParts.length-1],domainParts=domainParts.slice(0,-1)),domainParts.length>2&&(domainParts=domainParts.slice(-2)),calculatedDomain=domainParts.join(".")+domainCountryCode,calculatedDomain=userNameValue+version+"@"+calculatedDomain,"answer"===passwordType&&(securityQuestionValue=securityQuestionValue.replace(/[.,-\/#!$%\^&\*;:{}=\-_`~()?'']/g,"").replace(/  +/g," ").trim().toLowerCase(),calculatedDomain=calculatedDomain+":"+securityQuestionValue),pBKDF2(openSesame.passPhrase,salt,750,128).then(function(key){return hMACSHA256(calculatedDomain,key)}).then(function(seedArray){let passLength=openSesame.passwordTypes[passwordType].length,spaces=openSesame.passwordTypes[passwordType].spaces||[],charSet=openSesame.passwordTypes[passwordType].charSet,password="";for(let s=0;s<seedArray.length;s++)s<passLength&&(password+=spaces.indexOf[s]>=0?" ":charSet[seedArray[s]%charSet.length]),seedArray[s]=0;passPhrase=zeroVar(passPhrase),resolve(password)}).catch(function(e){return Promise.reject(e)})})}catch(e){return Promise.reject(e)}};