function clearPassword(){hideElement(passwordCard),password.textContent="00000000000000000000000000000000000000000000000000000000000000000000000000000",password.textContent="",setPasswordButton()}function trimDomainName(){var e=0;domainName.value=domainName.value.replace(/^https?:\/\//g,"").toLowerCase().trim(),e=domainName.value.indexOf("/"),e>0&&(domainName.value=domainName.value.substr(0,e))}function clearValues(){passPhrase.value="00000000000000000000000000000000000000000000000000000000000000000000000000000",passPhrase.value="",passChangeRequiredCount=0,clearPassword()}function generatePassword(){hidePasswordToggle(),showElement(passwordCard),error.textContent=password.textContent="",setPasswordButton(),fullName=givenName.value.trim()+familyName.value.trim(),""===fullName||0===passPhrase.value.trim().length||"answer"===passwordType&&0===securityQuestion.value.trim().length||("answer"!==passwordType||0!==securityQuestion.value.trim().length)&&(passOff.userName="",passOff.securityQuestion="",passOff.fullName=fullName,passOff.passPhrase=passPhrase.value,passOff.domainName=domainName.value.trim(),userName.value.trim().length>0&&(passOff.userName=userName.value.trim()),"answer"===passwordType&&securityQuestion.value.trim().length>0&&(passOff.securityQuestion=securityQuestion.value.trim()),passwordType&&passOff.generatePassword(passwordType).then(function(e){clearBodyClasses(),"answer"===passwordType?bodyNode.classList.add("ext-answer-generated"):bodyNode.classList.add("ext-pass-generated"),password.textContent=e,hideElement(loaderPassword),populateOrCopyPassword(),setPassChangeRequired()})["catch"](function(e){error.textContent=e.message}))}function populateOrCopyPassword(){var e=!1;"undefined"!=typeof isChromeExtension?(generateExtPassword(),extHasPassword!==!0||"User name"===passwordCardHeader.textContent||"Answer"===passwordCardHeader.textContent?e=!0:(successToast.textContent=successPrefix+" inserted",window.setTimeout(function(){showToast(successToast,copyPasswordDiv)},250))):document.queryCommandSupported("copy")&&(e=!0),e&&(showElement(copyPasswordDiv),password.scrollIntoView(),window.setTimeout(function(){copyPasswordToClipboard()},200))}function setPassChangeRequired(){var e;passChangeRequiredCount=2,lastPassPhraseLength=passPhrase.value.length,lastPassGenTimeStamp=Date.now(),e=lastPassGenTimeStamp,window.setTimeout(function(){e===lastPassGenTimeStamp&&clearValues()},18e5)}function changePassPhrase(){clearPassword(),lastPassPhraseLength>0&&passChangeRequiredCount>0&&passPhrase.value.length<=lastPassPhraseLength?passChangeRequiredCount-=1:(0===lastPassPhraseLength||0===passChangeRequiredCount)&&showPasswordToggle()}function setPasswordButton(){var e=domainName.value.replace("https://","").replace("http://","").replace(/^www[\w-]*./g,"").trim().toLowerCase();("w"===e||"ww"===e||"www"===e)&&(e=""),(givenName.value.trim().length>0||familyName.value.trim().length>0)&&e.length>0&&("answer"!==passwordType||securityQuestion.value.trim().length>0)?generatePasswordButton.disabled=!1:generatePasswordButton.disabled=!0,hideElement(copyPasswordDiv)}function showElement(e){e.classList.remove("hidden")}function hideElement(e){e.classList.add("hidden")}function clearBodyClasses(){bodyNode.classList.remove("ext-pass"),bodyNode.classList.remove("ext-answer"),bodyNode.classList.remove("ext-pass-generated"),bodyNode.classList.remove("ext-answer-generated")}function copyPasswordToClipboard(){if(clipboardVal.value=password.textContent,clipboardVal.select(),document.queryCommandEnabled("copy"))try{document.execCommand("copy");successToast.textContent=successPrefix+" copied to Clipboard",showToast(successToast,copyPasswordDiv)}catch(e){console.log("Copy command failed")}else console.log("Copy command not enabled")}function clearClipboard(){if(clipboardVal.value="Value cleared",clipboardVal.select(),document.queryCommandSupported("copy"))try{document.execCommand("copy")}catch(e){console.log("Copy command failed")}else console.log("Copy command not enabled")}function chooseType(){setType(this.id)}function setType(e){switch(copyPasswordButton.textContent="Copy Password",successPrefix="Password",passwordCardHeader.textContent="Password",showElement(userNameDiv),hideElement(securityQuestionDiv),passwordType=e,e){case"login":generatePasswordButton.textContent="Generate User name",copyPasswordButton.textContent="Copy User name",successPrefix="User name",passwordCardHeader.textContent="User name",hideElement(userNameDiv);break;case"maximum-password":generatePasswordButton.textContent="Generate Maximum Password";break;case"long-password":generatePasswordButton.textContent="Generate Long Password";break;case"medium-password":generatePasswordButton.textContent="Generate Medium Password";break;case"basic-password":generatePasswordButton.textContent="Generate Basic Password";break;case"short-password":generatePasswordButton.textContent="Generate Short Password";break;case"pin":generatePasswordButton.textContent="Generate Four Digit PIN",copyPasswordButton.textContent="Copy PIN",successPrefix="PIN",passwordCardHeader.textContent="PIN";break;case"pin-6":generatePasswordButton.textContent="Generate Six Digit PIN",copyPasswordButton.textContent="Copy PIN",successPrefix="PIN",passwordCardHeader.textContent="PIN";break;case"answer":generatePasswordButton.textContent="Generate Security Answer",copyPasswordButton.textContent="Copy Security Answer",successPrefix="Answer",passwordCardHeader.textContent="Answer",showElement(securityQuestionDiv)}clearBodyClasses(),"answer"===passwordType?bodyNode.classList.add("ext-answer"):bodyNode.classList.add("ext-pass"),clearPassword()}function showPasswordToggle(){0===passChangeRequiredCount&&showElement(passwordToggle)}function hidePasswordToggle(){hideElement(passwordToggle),passPhrase.type="password"}function togglePasswordView(){"password"===passPhrase.type?passPhrase.type="text-area":passPhrase.type="password",passPhrase.focus()}function runTests(){window.open("test/opensesame-test.html")}function showToast(e,s){hideElement(s),showElement(e),e.scrollIntoView(),window.setTimeout(function(){hideToast(e,s)},5200)}function hideToast(e,s){showElement(s),hideElement(e)}function generateExtPassword(){chrome.runtime.sendMessage({message:"set_password",givenName:givenName.value,familyName:familyName.value,passPhrase:passPhrase.value,password:password.value,passwordType:passwordType})}function setValuePopulated(e){e.parentElement.classList.add("is-dirty")}var PassOff=function(){"use strict";this.keyNS="cake.man.passoff",this.passwordNS="cake.man.passoff.password",this.loginNS="cake.man.passoff.login",this.answerNS="cake.man.passoff.answer",this.fullName="",this.passPhrase="",this.domainName="",this.userName="",this.securityQuestion="",this.templates={"maximum-password":["anoxxxxxxxxxxxxxxxxx","axxxxxxxxxxxxxxxxxno"],"long-password":["CvcvnoCvcvCvcv","CvcvCvcvnoCvcv","CvcvCvcvCvcvno","CvccnoCvcvCvcv","CvccCvcvnoCvcv","CvccCvcvCvcvno","CvcvnoCvccCvcv","CvcvCvccnoCvcv","CvcvCvccCvcvno","CvcvnoCvcvCvcc","CvcvCvcvnoCvcc","CvcvCvcvCvccno","CvccnoCvccCvcv","CvccCvccnoCvcv","CvccCvccCvcvno","CvcvnoCvccCvcc","CvcvCvccnoCvcc","CvcvCvccCvccno","CvccnoCvcvCvcc","CvccCvcvnoCvcc","CvccCvcvCvccno"],"medium-password":["CvcnoCvc","CvcCvcno"],"basic-password":["aaanaaan","aannaaan","aaannaaa"],"short-password":["Cvcn"],pin:["nnnn"],"pin-6":["nnnnnn"],login:["cvccvcvcv"],answer:["cvcc cvc cvccvcv cvc","cvc cvccvcvcv cvcv","cv cvccv cvc cvcvccv"]},this.passchars={V:"AEIOU",C:"BCDFGHJKLMNPQRSTVWXYZ",v:"aeiou",c:"bcdfghjklmnpqrstvwxyz",A:"AEIOUBCDFGHJKLMNPQRSTVWXYZ",a:"AEIOUaeiouBCDFGHJKLMNPQRSTVWXYZbcdfghjklmnpqrstvwxyz",n:"0123456789",o:"@&%?,=[]_:-+*$#!'^~;()/.",x:"AEIOUaeiouBCDFGHJKLMNPQRSTVWXYZbcdfghjklmnpqrstvwxyz0123456789!@#$%^&*()"," ":" "},this.countryTLDs=["ac","ad","ae","af","ag","ai","al","am","an","ao","aq","ar","as","at","au","aw","ax","az","ba","bb","bd","be","bf","bg","bh","bi","bj","bm","bn","bo","br","bs","bt","bv","bw","by","bz","ca","cc","cd","cf","cg","ch","ci","ck","cl","cm","cn","co","cr","cs","cu","cv","cw","cx","cy","cz","dd","de","dj","dk","dm","do","dz","ec","ee","eg","eh","er","es","et","eu","fi","fj","fk","fm","fo","fr","ga","gb","gd","ge","gf","gg","gh","gi","gl","gm","gn","gp","gq","gr","gs","gt","gu","gw","gy","hk","hm","hn","hr","ht","hu","id","ie","il","im","in","iq","ir","is","it","je","jm","jo","jp","ke","kg","kh","ki","km","kn","kp","kr","kw","ky","kz","la","lb","lc","li","lk","lr","ls","lt","lu","lv","ly","ma","mc","md","me","mg","mh","mk","ml","mm","mn","mo","mp","mq","mr","ms","mt","mu","mv","mw","mx","my","mz","na","nc","ne","nf","ng","ni","nl","no","np","nr","nu","nz","om","pa","pe","pf","pg","ph","pk","pl","pm","pn","pr","ps","pt","pw","py","qa","re","ro","rs","ru","rw","sa","sb","sc","sd","se","sg","sh","si","sj","sk","sl","sm","sn","so","sr","ss","st","su","sv","sx","sy","sz","tc","td","tf","tg","th","tj","tk","tl","tm","tn","to","tp","tr","tt","tv","tw","tz","ua","ug","uk","us","uy","uz","va","vc","ve","vg","vi","vn","vu","wf","ws","ye","yt","yu","za","zm","zw"]};PassOff.prototype.PBKDF2=function(e,s){"use strict";return new Promise(function(a,t){var o=CryptoJS.PBKDF2(e,s,{iterations:750,keySize:4});a(o)})},PassOff.prototype.HMACSHA256=function(e,s){"use strict";return new Promise(function(a,t){var o=CryptoJS.HmacSHA256(e,s);a(o)})},PassOff.prototype.convertWordArrayToUint8Array=function(e){"use strict";var s,a,t=e.words.length,o=new Uint8Array(t<<2),r=0;for(a=0;t>a;a++)s=e.words[a],o[r++]=s>>24,o[r++]=s>>16&255,o[r++]=s>>8&255,o[r++]=255&s;return o},PassOff.prototype.clearPassPhrase=function(e){"use strict";this.passPhrase="00000000000000000000000000000000000000000000000000000000000000000000000000000",this.passPhrase=""},PassOff.prototype.generatePassword=function(e){"use strict";var s;performance.now();if(0===this.fullName.length)return Promise.reject(new Error("Name not present"));if(0===this.passPhrase.length)return Promise.reject(new Error("Passphrase not present"));if(0===this.domainName.length)return Promise.reject(new Error("Domain name not present"));if("answer"===e&&0===this.securityQuestion.length)return Promise.reject(new Error("Security question not present"));try{var a=this;return new Promise(function(t,o){s=a.passwordNS,"answer"===e?s=a.answerNS:"login"==e&&(s=a.loginNS);var r,n=a.fullName.trim().toLowerCase(),d=s+"."+n,c=a.userName.trim().toLowerCase(),i=0,u="",l=a.domainName.replace(/^https?:\/\//g,"").toLowerCase();i=l.indexOf("/"),i>0&&(l=l.substr(0,i)),r=l.split("."),r.length>1&&a.countryTLDs.indexOf(r[r.length-1])>=0&&(u="."+r[r.length-1],r=r.slice(0,-1)),r.length>2&&(r=r.slice(-2)),l=r.join(".")+u;var m="";return c&&c.length>0&&(l=c+"@"+l),"answer"===e&&(m=a.securityQuestion.replace(/[.,-\/#!$%\^&\*;:{}=\-_`~()?'"]/g,"").replace(/  +/g," ").trim().toLowerCase(),l=l+":"+m),a.PBKDF2(a.passPhrase,d).then(function(e){return a.HMACSHA256(l,e)}).then(function(e){var s=a.convertWordArrayToUint8Array(e);return s}).then(function(s){for(var o=a.templates[e],r=o[s[0]%o.length],n=r.split("").map(function(e,t){var o=a.passchars[e];return o[s[t+1]%o.length]}).join(""),d=0;d<s.length;d++)s[d]=0;a.clearPassPhrase(),t(n)})["catch"](function(e){return Promise.reject(e)})})}catch(t){return Promise.reject(t)}};var givenName,familyName,passPhrase,domainName,securityQuestion,securityQuestionDiv,userName,userNameDiv,type,resultType,generatePasswordButton,password,passwordCard,passwordCardHeader,copyPasswordDiv,loaderPassword,closePasswordButton,copyPasswordButton,bodyNode,clipboardVal,passwordToggle,headerKey,successToast,lastPassGenTimeStamp,successPrefix,passOff,passwordType,fullName,error,passChangeRequiredCount,lastPassPhraseLength;window.addEventListener("load",function(){window.applicationCache.addEventListener("updateready",function(e){window.applicationCache.status==window.applicationCache.UPDATEREADY&&window.location.reload()},!1),passOff=new PassOff,headerKey=document.querySelector("[id=header-key]"),givenName=document.querySelector("[id=given-name]"),familyName=document.querySelector("[id=family-name]"),passPhrase=document.querySelector("[id=passphrase]"),passwordToggle=document.querySelector("[id=show-password]"),generatePasswordButton=document.querySelector("[id=generate-password]"),domainName=document.querySelector("[id=domain]"),securityQuestion=document.querySelector("[id=security-question]"),securityQuestionDiv=document.querySelector("[id=security-question-div]"),userName=document.querySelector("[id=user-name]"),userNameDiv=document.querySelector("[id=user-name-div]"),type=document.querySelector("[id=type]"),passwordCard=document.querySelector("[id=password-card]"),passwordCardHeader=document.querySelector("[id=password-card-header]"),password=document.querySelector(".password"),clipboardVal=document.querySelector("[id=clipboard-value]"),error=document.querySelector(".error"),successToast=document.querySelector("[id=success-toast]"),copyPasswordButton=document.querySelector("[id=copy-password]"),copyPasswordDiv=document.querySelector("[id=copy-password-div]"),loaderPassword=document.querySelector("[id=load-bar-ball]"),closePasswordButton=document.querySelector("[id=close-password]"),bodyNode=document.querySelector("body"),givenName.disabled=familyName.disabled=passPhrase.disabled=domainName.disabled=userName.disabled=type.disabled=!1,givenName.addEventListener("input",clearPassword,!1),givenName.addEventListener("focus",hidePasswordToggle,!1),givenName.addEventListener("focusin",hidePasswordToggle,!1),familyName.addEventListener("input",clearPassword,!1),familyName.addEventListener("focus",hidePasswordToggle,!1),familyName.addEventListener("focusin",hidePasswordToggle,!1),passPhrase.addEventListener("input",changePassPhrase,!1),passPhrase.addEventListener("focus",showPasswordToggle,!1),passPhrase.addEventListener("focusin",showPasswordToggle,!1),securityQuestion.addEventListener("input",clearPassword,!1),securityQuestion.addEventListener("focus",hidePasswordToggle,!1),securityQuestion.addEventListener("focusin",hidePasswordToggle,!1),domainName.addEventListener("input",clearPassword,!1),domainName.addEventListener("focus",hidePasswordToggle,!1),domainName.addEventListener("focusin",hidePasswordToggle,!1),domainName.addEventListener("focusout",trimDomainName,!1),domainName.addEventListener("blur",trimDomainName,!1),userName.addEventListener("input",clearPassword,!1),userName.addEventListener("focus",hidePasswordToggle,!1),userName.addEventListener("focusin",hidePasswordToggle,!1);for(var e=0;e<type.children.length;e++)type.children[e].addEventListener("click",chooseType,!1);passChangeRequiredCount=0,lastPassPhraseLength=0,setType("long-password"),headerKey.addEventListener("click",runTests,!1),generatePasswordButton.addEventListener("click",generatePassword,!1),passwordToggle.addEventListener("click",togglePasswordView,!1),copyPasswordButton.addEventListener("click",copyPasswordToClipboard,!1),closePasswordButton.addEventListener("click",clearPassword,!1),givenName.focus()},!1);var isChromeExtension=!0,extHasPassword;document.addEventListener("DOMContentLoaded",function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){var s=e[0];chrome.tabs.sendMessage(s.id,{message:"clicked_browser_action"})})}),chrome.runtime.onMessage.addListener(function(e,s,a){"populate_fields"===e.message&&(domainName.value=e.url,givenName.value=e.givenName,familyName.value=e.familyName,passPhrase.value=e.passPhrase,extHasPassword=e.hasPassword,setType(e.passwordType)),domainName.value.length>0&&setValuePopulated(domainName),givenName.value.length>0&&setValuePopulated(givenName),familyName.value.length>0&&setValuePopulated(familyName),passPhrase.value.length>0&&(setValuePopulated(passPhrase),setPassChangeRequired())});
//# sourceMappingURL=ext-opensesame.min.js.map