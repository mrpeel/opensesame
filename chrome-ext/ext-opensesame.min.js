function prepServiceWorker(){if(navigator.serviceWorker){navigator.serviceWorker.register("sw.js").then(function(e){return navigator.serviceWorker.controller?e.waiting?void updateReady(e.waiting):e.installing?void trackInstalling(e.installing):void e.addEventListener("updatefound",function(){trackInstalling(e.installing)}):void 0});var e;navigator.serviceWorker.addEventListener("controllerchange",function(){e||(window.location.reload(),e=!0)})}}function trackInstalling(e){e.addEventListener("statechange",function(){"installed"==e.state&&updateReady(e)})}function updateReady(e){var t=document.getElementById("update-message"),s=document.getElementById("count-down-value"),a=[5,4,3,2,1];t.classList.remove("hidden"),window.setTimeout(function(){e.postMessage({action:"skipWaiting"})},5e3),a.forEach(function(e){window.setTimeout(function(){s.innerText=e},1e3*(5-e))})}function closeDialog(){var e=document.getElementById("confirm-dialog");clearPassPhraseAndStore(),e.classList.add("hidden")}function userNameUpdate(){var e=document.getElementById("options-summary"),t=document.getElementById("user-name").value;t.length>0&&(t=", "+t),e.innerText=passwordDescription+t}function checkRequired(e){var t=-1;e&&(t=requiredElements.indexOf(e)),-1==t&&(t=requiredElements.length);for(var s=0;t>s;s++){var a=document.getElementById(requiredElements[s]);a&&(a.value&&""!==a.value?a.parentElement.classList.remove("is-invalid"):a.parentElement.classList.add("is-invalid"))}}function openCloseOptions(){optionsVisible=!optionsVisible;var e=document.getElementById("extra-options-div"),t=document.getElementById("options-icon");optionsVisible?(e.classList.remove("hidden"),t.innerHTML="keyboard_arrow_up"):(e.classList.add("hidden"),t.innerHTML="keyboard_arrow_down")}function clearPassword(){hideElement("password-card"),password&&(password.textContent=zeroVar(password.textContent),password.textContent="")}function clearPassPhraseStore(){temporaryPhraseStore.clearStore(),"undefined"!=typeof isChromeExtension&&clearExtPhrase(),lastPassGenTimeStamp=Date.now()}function clearPassPhrase(){passPhrase&&(passPhrase.value=zeroVar(passPhrase.value),passPhrase.value=""),clearPassword()}function clearPassPhraseAndStore(){clearPassPhrase(),clearPassPhraseStore(),setPassPhraseScreenState("editing"),passPhrase.focus()}function setPassPhrase(e){passPhrase.value=e,setPassPhraseScreenState("holding"),passPhraseTimedClear()}function passPhraseTimedClear(){var e;lastPassGenTimeStamp=Date.now(),e=lastPassGenTimeStamp,window.setTimeout(function(){e===lastPassGenTimeStamp&&(clearPassPhrase(),setPassPhraseScreenState("stored"))},1e4)}function passwordGenerated(){passPhraseTimedClear(),temporaryPhraseStore.encryptPhrase(passPhrase.value,fullName).then(function(e){"undefined"!=typeof isChromeExtension&&storeExtPhrase()})["catch"](function(e){console.log(e)})}function generatePassword(){var e=document.getElementById("password"),t=document.getElementById("error");hidePassPhraseDisplayButton(),optionsVisible&&openCloseOptions(),hideElement("copy-password-div"),isReadyToGenerate()&&(showElement("password-card"),t.textContent=e.textContent="",passOff.userName="",passOff.securityQuestion="",passOff.fullName=fullName,passOff.passPhrase=passPhrase.value,passOff.domainName=domainName.value.trim(),userName.value.trim().length>0&&(passOff.userName=userName.value.trim()),"answer"===passwordType&&securityQuestion.value.trim().length>0&&(passOff.securityQuestion=securityQuestion.value.trim()),passwordType&&passOff.generatePassword(passwordType).then(function(t){clearBodyClasses(),"answer"===passwordType?bodyNode.classList.add("ext-answer-generated"):bodyNode.classList.add("ext-pass-generated"),e.textContent=t,hideElement("load-bar-ball"),populateOrCopyPassword(),passwordGenerated(),setPassPhraseScreenState("holding")})["catch"](function(e){t.textContent=e.message}))}function populateOrCopyPassword(){var e=!1;if("undefined"!=typeof isChromeExtension){var t=document.getElementById("password-card-header"),s=document.getElementById("success-toast");generateExtPassword(),extHasPassword!==!0||"User name"===t.textContent||"Answer"===t.textContent?e=!0:(s.textContent=successPrefix+" inserted",window.setTimeout(function(){showToast(s,"copy-password-div")},250))}else e=!0;e&&(showElement("copy-password-div"),password.scrollIntoView(),window.setTimeout(function(){copyPasswordToClipboard()},500))}function setPassPhraseScreenState(e){passPhraseState=e,"editing"===e?(showElement("passphrase-div"),hideElement("confirm-dialog"),hideElement("clear-passphrase")):"holding"===e?(showElement("passphrase-div"),hideElement("confirm-dialog")):"stored"===e?(showElement("confirm-dialog"),document.getElementById("header-key").scrollIntoView(),document.getElementById("confirm-passphrase").focus()):"failed"===e&&(hideElement("confirm-dialog"),showElement("passphrase-div"),showToast("failure-toast","passphrase-div"),window.setTimeout(function(){setPassPhraseScreenState("editing"),passPhrase.focus()},5250))}function checkConfirmation(){var e=document.getElementById("confirm-passphrase");3===e.value.length&&(confirmThreeChars(e.value,fullName),zeroVar(e.value),e.value="")}function confirmThreeChars(e,t){temporaryPhraseStore.decryptPhrase(e,t).then(function(e){setPassPhrase(e),setPassPhraseScreenState("holding")})["catch"](function(e){clearPassPhraseStore(),clearPassPhrase(),setPassPhraseScreenState("failed")})}function isReadyToGenerate(){checkRequired(),trimDomainName();var e=domainName.value.replace(/^www[\w-]*./g,"").trim().toLowerCase();return("w"===e||"ww"===e||"www"===e)&&(e=""),(givenName.value.trim().length>0||familyName.value.trim().length>0)&&passPhrase.value.trim().length>0&&e.length>0&&("answer"!==passwordType||securityQuestion.value.trim().length>0)?(fullName=givenName.value.trim()+familyName.value.trim(),!0):!1}function trimDomainName(){var e=0;domainName.value=domainName.value.replace(/^https?:\/\//g,"").toLowerCase().trim(),e=domainName.value.indexOf("/"),e>0&&(domainName.value=domainName.value.substr(0,e))}function showElement(e){var t=document.getElementById(e);t&&t.classList.remove("hidden")}function hideElement(e){var t=document.getElementById(e);t&&t.classList.add("hidden")}function clearBodyClasses(){bodyNode.classList.remove("ext-pass"),bodyNode.classList.remove("ext-answer"),bodyNode.classList.remove("ext-pass-generated"),bodyNode.classList.remove("ext-answer-generated")}function copyPasswordToClipboard(){var e=document.getElementById("clipboard-value");e.value=password.textContent,e.select();try{document.execCommand("copy")&&(document.getElementById("success-toast").textContent=successPrefix+" copied to Clipboard",showToast("success-toast","copy-password-div"))}catch(t){hideElement("copy-password-div"),console.log("Copy command failed")}}function chooseType(){setType(this.id)}function setType(e){var t=document.getElementById("generate-password"),s=document.getElementById("copy-password"),a=document.getElementById("password-card-header");s.textContent="Copy Password",successPrefix="Password",a.textContent="Password",showElement("user-name-div"),hideElement("security-question-div"),passwordType=e;var n=document.getElementById("password-selected");switch(e){case"login":t.textContent="User name",passwordDescription="User name",s.textContent="Copy User name",successPrefix="User name",a.textContent="User name",n.innerText="User name",hideElement("user-name-div");break;case"maximum-password":t.textContent="Produce Maximum Password",passwordDescription="Maximum password",n.innerText="Maximum password (20 characters)";break;case"long-password":t.textContent="Produce Long Password",passwordDescription="Long password",n.innerText="Long password (14 characters)";break;case"medium-password":t.textContent="Produce Medium Password",passwordDescription="Medium password",n.innerText="Medium password (8 characters)";break;case"basic-password":t.textContent="Produce Basic Password",passwordDescription="Basic password",n.innerText="Basic password (8 chars - letters and numbers)";break;case"short-password":t.textContent="Produce Short Password",passwordDescription="Short password",n.innerText="Short password (4 chars - letters and numbers)";break;case"pin":t.textContent="Produce Four Digit PIN",passwordDescription="Four digit PIN",s.textContent="Copy PIN",successPrefix="PIN",a.textContent="PIN",n.innerText="Four digit PIN";break;case"pin-6":t.textContent="Produce Six Digit PIN",passwordDescription="Six digit PIN",s.textContent="Copy PIN",successPrefix="PIN",a.textContent="PIN",n.innerText="Six digit PIN";break;case"answer":t.textContent="Produce Security Answer",passwordDescription="Security answer",s.textContent="Copy Security Answer",successPrefix="Answer",a.textContent="Answer",showElement("security-question-div"),n.innerText="Security answer"}userNameUpdate(),clearBodyClasses(),"answer"===passwordType?bodyNode.classList.add("ext-answer"):bodyNode.classList.add("ext-pass"),clearPassword()}function showPassPhraseDisplayButton(){"editing"===passPhraseState||"failed"===passPhraseState?showElement("show-passphrase"):"holding"===passPhraseState&&showElement("clear-passphrase")}function hidePassPhraseDisplayButton(){hideElement("show-passphrase"),hideElement("clear-passphrase"),passPhrase.type="password"}function togglePassPhraseView(){var e=document.getElementById("show-passphrase");"password"===passPhrase.type?(passPhrase.type="text-area",e.innerHTML='<i class="material-icons">visibility_off</i>'):(passPhrase.type="password",e.innerHTML='<i class="material-icons">visibility</i>'),passPhrase.focus()}function runTests(){"undefined"!=typeof isChromeExtension?window.open("https://mrpeel.github.io/opensesame/test/opensesame-test.html"):window.open("test/opensesame-test.html")}function showToast(e,t){hideElement(t),showElement(e);var s=document.getElementById(e);s.scrollIntoView(),window.setTimeout(function(){hideToast(e,t)},5200)}function hideToast(e,t){showElement(t),hideElement(e)}function setPassChangeRequired(){var e;passChangeRequiredCount=2,lastPassPhraseLength=passPhrase.value.length,lastPassGenTimeStamp=Date.now(),e=lastPassGenTimeStamp,window.setTimeout(function(){e===lastPassGenTimeStamp&&clearPassPhrase()},18e5)}function changePassPhrase(){clearPassword(),showPassPhraseDisplayButton()}function generateExtPassword(){chrome.runtime.sendMessage({message:"set_password",givenName:givenName.value,familyName:familyName.value,passPhrase:passPhrase.value,password:password.textContent,passwordType:passwordType})}function storeExtPhrase(){chrome.runtime.sendMessage({message:"store_phrase",threeCharHash:temporaryPhraseStore.threeCharHash,phraseStore:temporaryPhraseStore.encData})}function clearExtPhrase(){chrome.runtime.sendMessage({message:"clear_stored_phrase"})}function setValuePopulated(e){e.parentElement.classList.add("is-dirty")}function PBKDF2(e,t,s,a){"use strict";if(window.crypto&&window.crypto.subtle){var n=new TextEncoder("utf-8"),r=n.encode(t),o=n.encode(e);return window.crypto.subtle.importKey("raw",o,{name:"PBKDF2"},!1,["deriveBits"]).then(function(e){return window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:s,salt:r,hash:"SHA-1"},e,a)})}return new Promise(function(n,r){var o=CryptoJS.PBKDF2(e,t,{iterations:s,keySize:a/32});n(o)})}function HMACSHA256(e,t){"use strict";return window.crypto&&window.crypto.subtle?new Promise(function(s,a){var n=new TextEncoder("utf-8"),r=n.encode(e);window.crypto.subtle.importKey("raw",t,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]).then(function(e){return window.crypto.subtle.sign({name:"HMAC",hash:{name:"SHA-256"}},e,r)}).then(function(e){var t=new Uint8Array(e);s(t)})}):new Promise(function(s,a){var n=CryptoJS.HmacSHA256(e,t),r=convertWordArrayToUint8Array(n);s(r)})}function aesEncrypt(e,t){"use strict";return window.crypto&&window.crypto.subtle?new Promise(function(s,a){var n=new TextEncoder("utf-8"),r=n.encode(e),o=convertHexToUint8Array(t),i=window.crypto.getRandomValues(new Uint8Array(16));window.crypto.subtle.importKey("raw",o,{name:"AES-CBC",length:128},!1,["encrypt"]).then(function(e){return window.crypto.subtle.encrypt({name:"AES-CBC",iv:i},e,r)}).then(function(e){var t=new Uint8Array(e);s({iv:i,ciphertext:t})})}):new Promise(function(s,a){var n=CryptoJS.AES.encrypt(e,t);s(n)})}function aesDecrypt(e,t){"use strict";return window.crypto&&window.crypto.subtle?new Promise(function(s,a){var n=(new TextEncoder("utf-8"),new TextDecoder("utf-8")),r=convertHexToUint8Array(t);window.crypto.subtle.importKey("raw",r,{name:"AES-CBC",length:128},!1,["decrypt"]).then(function(t){return window.crypto.subtle.decrypt({name:"AES-CBC",iv:e.iv},t,e.ciphertext)}).then(function(e){var t=new Uint8Array(e),a=n.decode(t);s(a)})}):new Promise(function(s,a){var n=CryptoJS.AES.decrypt(e,t),r=CryptoJS.enc.Utf8.stringify(n);s(r)})}function convertDerivedKeyToHex(e){"use strict";return convertUint8ArrayToHex(window.crypto&&window.crypto.subtle?new Uint8Array(e):convertWordArrayToUint8Array(e))}function convertWordArrayToHex(e){"use strict";return convertUint8ArrayToHex(convertWordArrayToUint8Array(e))}function convertWordArrayToUint8Array(e){"use strict";for(var t=e.words,s=e.sigBytes,a=new Uint8Array(s),n=0;s>n;n++){var r=t[n>>>2]>>>24-n%4*8&255;a[n]=r}return a}function convertUint8ArrayToHex(e){var t,s,a,n="";for(t=0,s=e.length;s>t;t+=1)a=e[t].toString(16),a.length<2&&(a="0"+a),n+=a;return n}function convertHexToUint8Array(e){var t,s,a=e.length/2,n=0;if(a!==parseInt(a,10))throw new Error("Invalid hex length '"+e.length+"'");for(s=new Uint8Array(a),t=0;a>t;t+=1)s[t]=parseInt(e[n]+e[n+1],16),n+=2;return s}function zeroVar(e){return Array(e.length).join("0")}function zeroIntArray(e){for(var t=e,s=0;s<e.length;s++)t[s]=0;return t}var TemporaryPhraseStore=function(){this.ns="cake.man.io"};TemporaryPhraseStore.prototype.encryptPhrase=function(e,t){"use strict";var s,a=this;return new Promise(function(n,r){if("string"==typeof e&&e.length>=3){var o=e.substring(0,3);PBKDF2(t+o,t+a.ns,500,128).then(function(e){return s=convertDerivedKeyToHex(e),PBKDF2(convertDerivedKeyToHex(e),t+o,250,128)}).then(function(t){return a.threeCharHash=convertDerivedKeyToHex(t),aesEncrypt(e,s)}).then(function(e){a.encData=e,n("Success")})["catch"](function(e){r(e)})}else r("Pass phrase must be a sring at least three characters long")})},TemporaryPhraseStore.prototype.decryptPhrase=function(e,t){"use strict";var s,a=this;return new Promise(function(n,r){"undefined"==typeof a.encData?r("No encrypted data found"):"string"!=typeof e||3!==e.length?(a.clearStore(),r("First three characters parameter is not a 3 character string")):PBKDF2(t+e,t+a.ns,500,128).then(function(a){return s=convertDerivedKeyToHex(a),PBKDF2(convertDerivedKeyToHex(a),t+e,250,128)}).then(function(e){a.threeCharHash===convertDerivedKeyToHex(e)?aesDecrypt(a.encData,s).then(function(e){n(e)}):(a.clearStore(),r("First three characters did not match"))})})},TemporaryPhraseStore.prototype.clearStore=function(){"use strict";"undefined"!=typeof this.threeCharHash&&(zeroVar(this.threeCharHash),delete this.threeCharHash),"undefined"!=typeof this.encData&&("string"==typeof this.encData.iv?(zeroVar(this.encData.iv),this.encData.iv=""):"Uint8Array"===this.encData.iv.constructor.name&&(zeroIntArray(this.encData.iv),this.encData.iv=[]),"string"==typeof this.encData.ciphertext?(zeroVar(this.encData.ciphertext),this.encData.ciphertext=""):"Uint8Array"===this.encData.ciphertext.constructor.name&&(zeroIntArray(this.encData.ciphertext),this.encData.ciphertext=[]),delete this.encData)},TemporaryPhraseStore.prototype.storeValues=function(e,t){"use strict";this.threeCharHash=e,this.encData=t};var PassOff=function(){"use strict";this.keyNS="cake.man.passoff",this.passwordNS="cake.man.passoff.password",this.loginNS="cake.man.passoff.login",this.answerNS="cake.man.passoff.answer",this.fullName="",this.passPhrase="",this.domainName="",this.userName="",this.securityQuestion="",this.templates={"maximum-password":["anoxxxxxxxxxxxxxxxxx","axxxxxxxxxxxxxxxxxno"],"long-password":["CvcvnoCvcvCvcv","CvcvCvcvnoCvcv","CvcvCvcvCvcvno","CvccnoCvcvCvcv","CvccCvcvnoCvcv","CvccCvcvCvcvno","CvcvnoCvccCvcv","CvcvCvccnoCvcv","CvcvCvccCvcvno","CvcvnoCvcvCvcc","CvcvCvcvnoCvcc","CvcvCvcvCvccno","CvccnoCvccCvcv","CvccCvccnoCvcv","CvccCvccCvcvno","CvcvnoCvccCvcc","CvcvCvccnoCvcc","CvcvCvccCvccno","CvccnoCvcvCvcc","CvccCvcvnoCvcc","CvccCvcvCvccno"],"medium-password":["CvcnoCvc","CvcCvcno"],"basic-password":["aaanaaan","aannaaan","aaannaaa"],"short-password":["Cvcn"],pin:["nnnn"],"pin-6":["nnnnnn"],login:["cvccvcvcv"],answer:["cvcc cvc cvccvcv cvc","cvc cvccvcvcv cvcv","cv cvccv cvc cvcvccv"]},this.passchars={V:"AEIOU",C:"BCDFGHJKLMNPQRSTVWXYZ",v:"aeiou",c:"bcdfghjklmnpqrstvwxyz",A:"AEIOUBCDFGHJKLMNPQRSTVWXYZ",a:"AEIOUaeiouBCDFGHJKLMNPQRSTVWXYZbcdfghjklmnpqrstvwxyz",n:"0123456789",o:"@&%?,=[]_:-+*$#!'^~;()/.",x:"AEIOUaeiouBCDFGHJKLMNPQRSTVWXYZbcdfghjklmnpqrstvwxyz0123456789!@#$%^&*()"," ":" "},this.countryTLDs=["ac","ad","ae","af","ag","ai","al","am","an","ao","aq","ar","as","at","au","aw","ax","az","ba","bb","bd","be","bf","bg","bh","bi","bj","bm","bn","bo","br","bs","bt","bv","bw","by","bz","ca","cc","cd","cf","cg","ch","ci","ck","cl","cm","cn","co","cr","cs","cu","cv","cw","cx","cy","cz","dd","de","dj","dk","dm","do","dz","ec","ee","eg","eh","er","es","et","eu","fi","fj","fk","fm","fo","fr","ga","gb","gd","ge","gf","gg","gh","gi","gl","gm","gn","gp","gq","gr","gs","gt","gu","gw","gy","hk","hm","hn","hr","ht","hu","id","ie","il","im","in","iq","ir","is","it","je","jm","jo","jp","ke","kg","kh","ki","km","kn","kp","kr","kw","ky","kz","la","lb","lc","li","lk","lr","ls","lt","lu","lv","ly","ma","mc","md","me","mg","mh","mk","ml","mm","mn","mo","mp","mq","mr","ms","mt","mu","mv","mw","mx","my","mz","na","nc","ne","nf","ng","ni","nl","no","np","nr","nu","nz","om","pa","pe","pf","pg","ph","pk","pl","pm","pn","pr","ps","pt","pw","py","qa","re","ro","rs","ru","rw","sa","sb","sc","sd","se","sg","sh","si","sj","sk","sl","sm","sn","so","sr","ss","st","su","sv","sx","sy","sz","tc","td","tf","tg","th","tj","tk","tl","tm","tn","to","tp","tr","tt","tv","tw","tz","ua","ug","uk","us","uy","uz","va","vc","ve","vg","vi","vn","vu","wf","ws","ye","yt","yu","za","zm","zw"]};PassOff.prototype.clearPassPhrase=function(){"use strict";this.passPhrase=zeroVar(this.passPhrase),this.passPhrase=""},PassOff.prototype.generatePassword=function(e){"use strict";var t;performance.now();if(0===this.fullName.length)return Promise.reject(new Error("Name not present"));if(0===this.passPhrase.length)return Promise.reject(new Error("Passphrase not present"));if(0===this.domainName.length)return Promise.reject(new Error("Domain name not present"));if("answer"===e&&0===this.securityQuestion.length)return Promise.reject(new Error("Security question not present"));try{var s=this;return new Promise(function(a,n){t=s.passwordNS,"answer"===e?t=s.answerNS:"login"==e&&(t=s.loginNS);var r,o=s.fullName.trim().toLowerCase(),i=t+"."+o,c=s.userName.trim().toLowerCase(),d=0,u="",m=s.domainName.replace(/^https?:\/\//g,"").toLowerCase();d=m.indexOf("/"),d>0&&(m=m.substr(0,d)),r=m.split("."),r.length>1&&s.countryTLDs.indexOf(r[r.length-1])>=0&&(u="."+r[r.length-1],r=r.slice(0,-1)),r.length>2&&(r=r.slice(-2)),m=r.join(".")+u;var l="";return c&&c.length>0&&(m=c+"@"+m),"answer"===e&&(l=s.securityQuestion.replace(/[.,-\/#!$%\^&\*;:{}=\-_`~()?'"]/g,"").replace(/  +/g," ").trim().toLowerCase(),m=m+":"+l),PBKDF2(s.passPhrase,i,750,128).then(function(e){return HMACSHA256(m,e)}).then(function(t){for(var n=s.templates[e],r=n[t[0]%n.length],o=r.split("").map(function(e,a){var n=s.passchars[e];return n[t[a+1]%n.length]}).join(""),i=0;i<t.length;i++)t[i]=0;s.clearPassPhrase(),a(o)})["catch"](function(e){return Promise.reject(e)})})}catch(a){return Promise.reject(a)}};var passPhrase,givenName,familyName,domainName,securityQuestion,userName,type,bodyNode,password,optionsVisible=!1,requiredElements=["given-name","family-name","passphrase","domain"],passOff,temporaryPhraseStore,passwordType,fullName,passChangeRequiredCount,lastPassPhraseLength,lastPassGenTimeStamp,successPrefix,passPhraseState,passwordDescription="Long password";window.addEventListener("load",function(){window.applicationCache.addEventListener("updateready",function(e){window.applicationCache.status==window.applicationCache.UPDATEREADY&&window.location.reload()},!1),passOff=new PassOff,temporaryPhraseStore=new TemporaryPhraseStore,passPhrase=document.getElementById("passphrase"),givenName=document.getElementById("given-name"),familyName=document.getElementById("family-name"),domainName=document.getElementById("domain"),securityQuestion=document.getElementById("security-question"),userName=document.getElementById("user-name"),type=document.getElementById("type"),bodyNode=document.querySelector("body"),password=document.getElementById("password"),givenName.addEventListener("input",clearPassword,!1),familyName.addEventListener("input",function(){checkRequired("family-name"),clearPassword()},!1),passPhrase.addEventListener("input",function(){checkRequired("passphrase"),clearPassword()},!1),domainName.addEventListener("input",function(){checkRequired("domain"),clearPassword()},!1),securityQuestion.addEventListener("input",function(){checkRequired(),clearPassword()},!1),userName.addEventListener("input",function(){checkRequired(),clearPassword()},!1),passPhrase.addEventListener("focus",showPassPhraseDisplayButton,!1),passPhrase.addEventListener("focusin",showPassPhraseDisplayButton,!1),domainName.addEventListener("focusout",trimDomainName,!1),domainName.addEventListener("blur",trimDomainName,!1),document.getElementById("confirm-passphrase").addEventListener("input",checkConfirmation,!1),givenName.addEventListener("focus",hidePassPhraseDisplayButton,!1),givenName.addEventListener("focusin",hidePassPhraseDisplayButton,!1),familyName.addEventListener("focus",hidePassPhraseDisplayButton,!1),familyName.addEventListener("focusin",hidePassPhraseDisplayButton,!1),domainName.addEventListener("focus",hidePassPhraseDisplayButton,!1),domainName.addEventListener("focusin",hidePassPhraseDisplayButton,!1),securityQuestion.addEventListener("focus",hidePassPhraseDisplayButton,!1),securityQuestion.addEventListener("focusin",hidePassPhraseDisplayButton,!1),userName.addEventListener("focus",hidePassPhraseDisplayButton,!1),userName.addEventListener("focusin",hidePassPhraseDisplayButton,!1),userName.addEventListener("focusout",userNameUpdate,!1),userName.addEventListener("blur",userNameUpdate,!1),document.getElementById("options").addEventListener("click",openCloseOptions,!1),document.getElementById("password-type").addEventListener("click",function(){document.getElementById("password-options").click()});for(var e=0;e<type.children.length;e++)type.children[e].addEventListener("click",chooseType,!1);document.getElementById("header-key").addEventListener("click",runTests,!1),document.getElementById("clear-passphrase").addEventListener("click",clearPassPhraseAndStore,!1),document.getElementById("show-passphrase").addEventListener("click",togglePassPhraseView,!1),document.getElementById("generate-password").addEventListener("click",generatePassword,!1),document.getElementById("copy-password").addEventListener("click",copyPasswordToClipboard,!1),document.getElementById("close-password").addEventListener("click",clearPassword,!1),document.getElementById("clear-close-dialog").addEventListener("click",closeDialog,!1),document.getElementById("close-password-confirm").addEventListener("click",closeDialog,!1),givenName.disabled=familyName.disabled=passPhrase.disabled=domainName.disabled=userName.disabled=type.disabled=!1,givenName.focus(),void 0===passwordType&&setType("long-password"),void 0===passPhraseState&&setPassPhraseScreenState("editing")},!1);var isChromeExtension=!0,extHasPassword;document.addEventListener("DOMContentLoaded",function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){var t=e[0];chrome.tabs.sendMessage(t.id,{message:"clicked_browser_action"})})}),chrome.runtime.onMessage.addListener(function(e,t,s){"populate_fields"===e.message&&(domainName.value=e.url,givenName.value=e.givenName,familyName.value=e.familyName,extHasPassword=e.hasPassword,setType(e.passwordType)),domainName.value.length>0&&setValuePopulated(domainName),givenName.value.length>0&&setValuePopulated(givenName),familyName.value.length>0&&setValuePopulated(familyName),e.passPhrase.length>0?(setValuePopulated(passPhrase),setPassPhrase(e.passPhrase),setPassPhraseScreenState("holding")):e.threeCharHash.length>0&&"undefined"!=typeof e.phraseStore.iv?(temporaryPhraseStore.storeValues(e.threeCharHash,e.phraseStore),setPassPhraseScreenState("stored")):setPassPhraseScreenState("editing")}),window.PBKDF2=PBKDF2,window.HMACSHA256=HMACSHA256,window.aesEncrypt=aesEncrypt,window.aesDecrypt=aesDecrypt,window.convertDerivedKeyToHex=convertDerivedKeyToHex,window.convertWordArrayToHex=convertWordArrayToHex,window.convertWordArrayToUint8Array=convertWordArrayToUint8Array,window.convertUint8ArrayToHex=convertUint8ArrayToHex,window.convertHexToUint8Array=convertHexToUint8Array,window.zeroVar=zeroVar,window.zeroIntArray=zeroIntArray;