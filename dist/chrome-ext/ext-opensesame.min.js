function clearPassword(){hideElement(passwordCard),password.textContent=zeroVar(password.textContent),password.textContent="",setPasswordButton()}function trimDomainName(){var e=0;domainName.value=domainName.value.replace(/^https?:\/\//g,"").toLowerCase().trim(),e=domainName.value.indexOf("/"),e>0&&(domainName.value=domainName.value.substr(0,e))}function clearValues(){passPhrase.value=zeroVar(passPhrase.value),passPhrase.value="",passChangeRequiredCount=0,clearPassword()}function generatePassword(){hidePasswordToggle(),showElement(passwordCard),error.textContent=password.textContent="",setPasswordButton(),fullName=givenName.value.trim()+familyName.value.trim(),""===fullName||0===passPhrase.value.trim().length||"answer"===passwordType&&0===securityQuestion.value.trim().length||("answer"!==passwordType||0!==securityQuestion.value.trim().length)&&(passOff.userName="",passOff.securityQuestion="",passOff.fullName=fullName,passOff.passPhrase=passPhrase.value,passOff.domainName=domainName.value.trim(),userName.value.trim().length>0&&(passOff.userName=userName.value.trim()),"answer"===passwordType&&securityQuestion.value.trim().length>0&&(passOff.securityQuestion=securityQuestion.value.trim()),passwordType&&passOff.generatePassword(passwordType).then(function(e){clearBodyClasses(),"answer"===passwordType?bodyNode.classList.add("ext-answer-generated"):bodyNode.classList.add("ext-pass-generated"),password.textContent=e,hideElement(loaderPassword),populateOrCopyPassword(),setPassChangeRequired()})["catch"](function(e){error.textContent=e.message}))}function populateOrCopyPassword(){var e=!1;"undefined"!=typeof isChromeExtension?(generateExtPassword(),extHasPassword!==!0||"User name"===passwordCardHeader.textContent||"Answer"===passwordCardHeader.textContent?e=!0:(successToast.textContent=successPrefix+" inserted",window.setTimeout(function(){showToast(successToast,copyPasswordDiv)},250))):document.queryCommandSupported("copy")&&(e=!0),e&&(showElement(copyPasswordDiv),password.scrollIntoView(),window.setTimeout(function(){copyPasswordToClipboard()},200))}function setPassChangeRequired(){var e;passChangeRequiredCount=2,lastPassPhraseLength=passPhrase.value.length,lastPassGenTimeStamp=Date.now(),e=lastPassGenTimeStamp,window.setTimeout(function(){e===lastPassGenTimeStamp&&clearValues()},18e5)}function changePassPhrase(){clearPassword(),lastPassPhraseLength>0&&passChangeRequiredCount>0&&passPhrase.value.length<=lastPassPhraseLength?passChangeRequiredCount-=1:(0===lastPassPhraseLength||0===passChangeRequiredCount)&&showPasswordToggle()}function setPasswordButton(){var e=domainName.value.replace("https://","").replace("http://","").replace(/^www[\w-]*./g,"").trim().toLowerCase();("w"===e||"ww"===e||"www"===e)&&(e=""),(givenName.value.trim().length>0||familyName.value.trim().length>0)&&passPhrase.value.trim().length>0&&e.length>0&&("answer"!==passwordType||securityQuestion.value.trim().length>0)?generatePasswordButton.disabled=!1:generatePasswordButton.disabled=!0,hideElement(copyPasswordDiv)}function showElement(e){e.classList.remove("hidden")}function hideElement(e){e.classList.add("hidden")}function clearBodyClasses(){bodyNode.classList.remove("ext-pass"),bodyNode.classList.remove("ext-answer"),bodyNode.classList.remove("ext-pass-generated"),bodyNode.classList.remove("ext-answer-generated")}function copyPasswordToClipboard(){if(clipboardVal.value=password.textContent,clipboardVal.select(),document.queryCommandEnabled("copy"))try{document.execCommand("copy");successToast.textContent=successPrefix+" copied to Clipboard",showToast(successToast,copyPasswordDiv)}catch(e){console.log("Copy command failed")}else console.log("Copy command not enabled")}function clearClipboard(){if(clipboardVal.value="Value cleared",clipboardVal.select(),document.queryCommandSupported("copy"))try{document.execCommand("copy")}catch(e){console.log("Copy command failed")}else console.log("Copy command not enabled")}function chooseType(){setType(this.id)}function setType(e){switch(copyPasswordButton.textContent="Copy Password",successPrefix="Password",passwordCardHeader.textContent="Password",showElement(userNameDiv),hideElement(securityQuestionDiv),passwordType=e,e){case"login":generatePasswordButton.textContent="User name",copyPasswordButton.textContent="Copy User name",successPrefix="User name",passwordCardHeader.textContent="User name",hideElement(userNameDiv);break;case"maximum-password":generatePasswordButton.textContent="Produce Maximum Password";break;case"long-password":generatePasswordButton.textContent="Produce Long Password";break;case"medium-password":generatePasswordButton.textContent="Produce Medium Password";break;case"basic-password":generatePasswordButton.textContent="Produce Basic Password";break;case"short-password":generatePasswordButton.textContent="Produce Short Password";break;case"pin":generatePasswordButton.textContent="Produce Four Digit PIN",copyPasswordButton.textContent="Copy PIN",successPrefix="PIN",passwordCardHeader.textContent="PIN";break;case"pin-6":generatePasswordButton.textContent="Produce Six Digit PIN",copyPasswordButton.textContent="Copy PIN",successPrefix="PIN",passwordCardHeader.textContent="PIN";break;case"answer":generatePasswordButton.textContent="Produce Security Answer",copyPasswordButton.textContent="Copy Security Answer",successPrefix="Answer",passwordCardHeader.textContent="Answer",showElement(securityQuestionDiv)}clearBodyClasses(),"answer"===passwordType?bodyNode.classList.add("ext-answer"):bodyNode.classList.add("ext-pass"),clearPassword()}function showPasswordToggle(){0===passChangeRequiredCount&&showElement(passwordToggle)}function hidePasswordToggle(){hideElement(passwordToggle),passPhrase.type="password"}function togglePasswordView(){"password"===passPhrase.type?passPhrase.type="text-area":passPhrase.type="password",passPhrase.focus()}function runTests(){"undefined"!=typeof isChromeExtension?window.open("https://mrpeel.github.io/opensesame/test/opensesame-test.html"):window.open("test/opensesame-test.html")}function showToast(e,s){hideElement(s),showElement(e),e.scrollIntoView(),window.setTimeout(function(){hideToast(e,s)},5200)}function hideToast(e,s){showElement(s),hideElement(e)}function generateExtPassword(){chrome.runtime.sendMessage({message:"set_password",givenName:givenName.value,familyName:familyName.value,passPhrase:passPhrase.value,password:password.textContent,passwordType:passwordType})}function setValuePopulated(e){e.parentElement.classList.add("is-dirty")}function PBKDF2(e,s,t,a){"use strict";if(window.crypto&&window.crypto.subtle){var r=new TextEncoder("utf-8"),o=r.encode(s),n=r.encode(e);return window.crypto.subtle.importKey("raw",n,{name:"PBKDF2"},!1,["deriveBits"]).then(function(e){return window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:t,salt:o,hash:"SHA-1"},e,a)})}return new Promise(function(r,o){var n=CryptoJS.PBKDF2(e,s,{iterations:t,keySize:a/32});r(n)})}function HMACSHA256(e,s){"use strict";return window.crypto&&window.crypto.subtle?new Promise(function(t,a){var r=new TextEncoder("utf-8"),o=r.encode(e);window.crypto.subtle.importKey("raw",s,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]).then(function(e){return window.crypto.subtle.sign({name:"HMAC",hash:{name:"SHA-256"}},e,o)}).then(function(e){var s=new Uint8Array(e);t(s)})}):new Promise(function(t,a){var r=CryptoJS.HmacSHA256(e,s),o=convertWordArrayToUint8Array(r);t(o)})}function aesEncrypt(e,s){"use strict";return window.crypto&&window.crypto.subtle?new Promise(function(t,a){var r=new TextEncoder("utf-8"),o=r.encode(e),n=convertHexToUint8Array(s),i=window.crypto.getRandomValues(new Uint8Array(16));window.crypto.subtle.importKey("raw",n,{name:"AES-CBC",length:128},!1,["encrypt"]).then(function(e){return window.crypto.subtle.encrypt({name:"AES-CBC",iv:i},e,o)}).then(function(e){var s=new Uint8Array(e);t({iv:i,ciphertext:s})})}):new Promise(function(t,a){var r=CryptoJS.AES.encrypt(e,s);t(r)})}function aesDecrypt(e,s){"use strict";return window.crypto&&window.crypto.subtle?new Promise(function(t,a){var r=(new TextEncoder("utf-8"),new TextDecoder("utf-8")),o=convertHexToUint8Array(s);window.crypto.subtle.importKey("raw",o,{name:"AES-CBC",length:128},!1,["decrypt"]).then(function(s){return window.crypto.subtle.decrypt({name:"AES-CBC",iv:e.iv},s,e.ciphertext)}).then(function(e){var s=new Uint8Array(e),a=r.decode(s);t(a)})}):new Promise(function(t,a){var r=CryptoJS.AES.decrypt(e,s),o=CryptoJS.enc.Utf8.stringify(r);t(o)})}function convertDerivedKeyToHex(e){"use strict";return convertUint8ArrayToHex(window.crypto&&window.crypto.subtle?new Uint8Array(e):convertWordArrayToUint8Array(e))}function convertWordArrayToHex(e){"use strict";return convertUint8ArrayToHex(convertWordArrayToUint8Array(e))}function convertWordArrayToUint8Array(e){"use strict";for(var s=e.words,t=e.sigBytes,a=new Uint8Array(t),r=0;t>r;r++){var o=s[r>>>2]>>>24-r%4*8&255;a[r]=o}return a}function convertUint8ArrayToHex(e){var s,t,a,r="";for(s=0,t=e.length;t>s;s+=1)a=e[s].toString(16),a.length<2&&(a="0"+a),r+=a;return r}function convertHexToUint8Array(e){var s,t,a=e.length/2,r=0;if(a!==parseInt(a,10))throw new Error("Invalid hex length '"+e.length+"'");for(t=new Uint8Array(a),s=0;a>s;s+=1)t[s]=parseInt(e[r]+e[r+1],16),r+=2;return t}function zeroVar(e){return Array(e.length).join("0")}function zeroIntArray(e){for(var s=e,t=0;t<e.length;t++)s[t]=0;return s}var PassOff=function(){"use strict";this.keyNS="cake.man.passoff",this.passwordNS="cake.man.passoff.password",this.loginNS="cake.man.passoff.login",this.answerNS="cake.man.passoff.answer",this.fullName="",this.passPhrase="",this.domainName="",this.userName="",this.securityQuestion="",this.templates={"maximum-password":["anoxxxxxxxxxxxxxxxxx","axxxxxxxxxxxxxxxxxno"],"long-password":["CvcvnoCvcvCvcv","CvcvCvcvnoCvcv","CvcvCvcvCvcvno","CvccnoCvcvCvcv","CvccCvcvnoCvcv","CvccCvcvCvcvno","CvcvnoCvccCvcv","CvcvCvccnoCvcv","CvcvCvccCvcvno","CvcvnoCvcvCvcc","CvcvCvcvnoCvcc","CvcvCvcvCvccno","CvccnoCvccCvcv","CvccCvccnoCvcv","CvccCvccCvcvno","CvcvnoCvccCvcc","CvcvCvccnoCvcc","CvcvCvccCvccno","CvccnoCvcvCvcc","CvccCvcvnoCvcc","CvccCvcvCvccno"],"medium-password":["CvcnoCvc","CvcCvcno"],"basic-password":["aaanaaan","aannaaan","aaannaaa"],"short-password":["Cvcn"],pin:["nnnn"],"pin-6":["nnnnnn"],login:["cvccvcvcv"],answer:["cvcc cvc cvccvcv cvc","cvc cvccvcvcv cvcv","cv cvccv cvc cvcvccv"]},this.passchars={V:"AEIOU",C:"BCDFGHJKLMNPQRSTVWXYZ",v:"aeiou",c:"bcdfghjklmnpqrstvwxyz",A:"AEIOUBCDFGHJKLMNPQRSTVWXYZ",a:"AEIOUaeiouBCDFGHJKLMNPQRSTVWXYZbcdfghjklmnpqrstvwxyz",n:"0123456789",o:"@&%?,=[]_:-+*$#!'^~;()/.",x:"AEIOUaeiouBCDFGHJKLMNPQRSTVWXYZbcdfghjklmnpqrstvwxyz0123456789!@#$%^&*()"," ":" "},this.countryTLDs=["ac","ad","ae","af","ag","ai","al","am","an","ao","aq","ar","as","at","au","aw","ax","az","ba","bb","bd","be","bf","bg","bh","bi","bj","bm","bn","bo","br","bs","bt","bv","bw","by","bz","ca","cc","cd","cf","cg","ch","ci","ck","cl","cm","cn","co","cr","cs","cu","cv","cw","cx","cy","cz","dd","de","dj","dk","dm","do","dz","ec","ee","eg","eh","er","es","et","eu","fi","fj","fk","fm","fo","fr","ga","gb","gd","ge","gf","gg","gh","gi","gl","gm","gn","gp","gq","gr","gs","gt","gu","gw","gy","hk","hm","hn","hr","ht","hu","id","ie","il","im","in","iq","ir","is","it","je","jm","jo","jp","ke","kg","kh","ki","km","kn","kp","kr","kw","ky","kz","la","lb","lc","li","lk","lr","ls","lt","lu","lv","ly","ma","mc","md","me","mg","mh","mk","ml","mm","mn","mo","mp","mq","mr","ms","mt","mu","mv","mw","mx","my","mz","na","nc","ne","nf","ng","ni","nl","no","np","nr","nu","nz","om","pa","pe","pf","pg","ph","pk","pl","pm","pn","pr","ps","pt","pw","py","qa","re","ro","rs","ru","rw","sa","sb","sc","sd","se","sg","sh","si","sj","sk","sl","sm","sn","so","sr","ss","st","su","sv","sx","sy","sz","tc","td","tf","tg","th","tj","tk","tl","tm","tn","to","tp","tr","tt","tv","tw","tz","ua","ug","uk","us","uy","uz","va","vc","ve","vg","vi","vn","vu","wf","ws","ye","yt","yu","za","zm","zw"]};PassOff.prototype.clearPassPhrase=function(){"use strict";this.passPhrase=zeroVar(this.passPhrase),this.passPhrase=""},PassOff.prototype.generatePassword=function(e){"use strict";var s;performance.now();if(0===this.fullName.length)return Promise.reject(new Error("Name not present"));if(0===this.passPhrase.length)return Promise.reject(new Error("Passphrase not present"));if(0===this.domainName.length)return Promise.reject(new Error("Domain name not present"));if("answer"===e&&0===this.securityQuestion.length)return Promise.reject(new Error("Security question not present"));try{var t=this;return new Promise(function(a,r){s=t.passwordNS,"answer"===e?s=t.answerNS:"login"==e&&(s=t.loginNS);var o,n=t.fullName.trim().toLowerCase(),i=s+"."+n,c=t.userName.trim().toLowerCase(),d=0,u="",l=t.domainName.replace(/^https?:\/\//g,"").toLowerCase();d=l.indexOf("/"),d>0&&(l=l.substr(0,d)),o=l.split("."),o.length>1&&t.countryTLDs.indexOf(o[o.length-1])>=0&&(u="."+o[o.length-1],o=o.slice(0,-1)),o.length>2&&(o=o.slice(-2)),l=o.join(".")+u;var w="";return c&&c.length>0&&(l=c+"@"+l),"answer"===e&&(w=t.securityQuestion.replace(/[.,-\/#!$%\^&\*;:{}=\-_`~()?'"]/g,"").replace(/  +/g," ").trim().toLowerCase(),l=l+":"+w),PBKDF2(t.passPhrase,i,750,128).then(function(e){return HMACSHA256(l,e)}).then(function(s){for(var r=t.templates[e],o=r[s[0]%r.length],n=o.split("").map(function(e,a){var r=t.passchars[e];return r[s[a+1]%r.length]}).join(""),i=0;i<s.length;i++)s[i]=0;t.clearPassPhrase(),a(n)})["catch"](function(e){return Promise.reject(e)})})}catch(a){return Promise.reject(a)}};var givenName,familyName,passPhrase,domainName,securityQuestion,securityQuestionDiv,userName,userNameDiv,type,resultType,generatePasswordButton,password,passwordCard,passwordCardHeader,copyPasswordDiv,loaderPassword,closePasswordButton,copyPasswordButton,bodyNode,clipboardVal,passwordToggle,headerKey,successToast,lastPassGenTimeStamp,successPrefix,passOff,passwordType,fullName,error,passChangeRequiredCount,lastPassPhraseLength;window.addEventListener("load",function(){window.applicationCache.addEventListener("updateready",function(e){window.applicationCache.status==window.applicationCache.UPDATEREADY&&window.location.reload()},!1),passOff=new PassOff,headerKey=document.querySelector("[id=header-key]"),givenName=document.querySelector("[id=given-name]"),familyName=document.querySelector("[id=family-name]"),passPhrase=document.querySelector("[id=passphrase]"),passwordToggle=document.querySelector("[id=show-password]"),generatePasswordButton=document.querySelector("[id=generate-password]"),domainName=document.querySelector("[id=domain]"),securityQuestion=document.querySelector("[id=security-question]"),securityQuestionDiv=document.querySelector("[id=security-question-div]"),userName=document.querySelector("[id=user-name]"),userNameDiv=document.querySelector("[id=user-name-div]"),type=document.querySelector("[id=type]"),passwordCard=document.querySelector("[id=password-card]"),passwordCardHeader=document.querySelector("[id=password-card-header]"),password=document.querySelector(".password"),clipboardVal=document.querySelector("[id=clipboard-value]"),error=document.querySelector(".error"),successToast=document.querySelector("[id=success-toast]"),copyPasswordButton=document.querySelector("[id=copy-password]"),copyPasswordDiv=document.querySelector("[id=copy-password-div]"),loaderPassword=document.querySelector("[id=load-bar-ball]"),closePasswordButton=document.querySelector("[id=close-password]"),bodyNode=document.querySelector("body"),givenName.disabled=familyName.disabled=passPhrase.disabled=domainName.disabled=userName.disabled=type.disabled=!1,givenName.addEventListener("input",clearPassword,!1),givenName.addEventListener("focus",hidePasswordToggle,!1),givenName.addEventListener("focusin",hidePasswordToggle,!1),familyName.addEventListener("input",clearPassword,!1),familyName.addEventListener("focus",hidePasswordToggle,!1),familyName.addEventListener("focusin",hidePasswordToggle,!1),passPhrase.addEventListener("input",changePassPhrase,!1),passPhrase.addEventListener("focus",showPasswordToggle,!1),passPhrase.addEventListener("focusin",showPasswordToggle,!1),securityQuestion.addEventListener("input",clearPassword,!1),securityQuestion.addEventListener("focus",hidePasswordToggle,!1),securityQuestion.addEventListener("focusin",hidePasswordToggle,!1),domainName.addEventListener("input",clearPassword,!1),domainName.addEventListener("focus",hidePasswordToggle,!1),domainName.addEventListener("focusin",hidePasswordToggle,!1),domainName.addEventListener("focusout",trimDomainName,!1),domainName.addEventListener("blur",trimDomainName,!1),userName.addEventListener("input",clearPassword,!1),userName.addEventListener("focus",hidePasswordToggle,!1),userName.addEventListener("focusin",hidePasswordToggle,!1);for(var e=0;e<type.children.length;e++)type.children[e].addEventListener("click",chooseType,!1);passChangeRequiredCount=0,lastPassPhraseLength=0,void 0===passwordType&&setType("long-password"),headerKey.addEventListener("click",runTests,!1),generatePasswordButton.addEventListener("click",generatePassword,!1),passwordToggle.addEventListener("click",togglePasswordView,!1),copyPasswordButton.addEventListener("click",copyPasswordToClipboard,!1),closePasswordButton.addEventListener("click",clearPassword,!1),givenName.focus()},!1);var isChromeExtension=!0,extHasPassword;document.addEventListener("DOMContentLoaded",function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){var s=e[0];chrome.tabs.sendMessage(s.id,{message:"clicked_browser_action"})})}),chrome.runtime.onMessage.addListener(function(e,s,t){"populate_fields"===e.message&&(domainName.value=e.url,givenName.value=e.givenName,familyName.value=e.familyName,passPhrase.value=e.passPhrase,extHasPassword=e.hasPassword,setType(e.passwordType)),domainName.value.length>0&&setValuePopulated(domainName),givenName.value.length>0&&setValuePopulated(givenName),familyName.value.length>0&&setValuePopulated(familyName),passPhrase.value.length>0&&(setValuePopulated(passPhrase),setPassChangeRequired())}),window.PBKDF2=PBKDF2,window.HMACSHA256=HMACSHA256,window.aesEncrypt=aesEncrypt,window.aesDecrypt=aesDecrypt,window.convertDerivedKeyToHex=convertDerivedKeyToHex,window.convertWordArrayToHex=convertWordArrayToHex,window.convertWordArrayToUint8Array=convertWordArrayToUint8Array,window.convertUint8ArrayToHex=convertUint8ArrayToHex,window.convertHexToUint8Array=convertHexToUint8Array,window.zeroVar=zeroVar,window.zeroIntArray=zeroIntArray;
//# sourceMappingURL=ext-opensesame.min.js.map