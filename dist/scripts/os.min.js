function assert(e,t){e||(console.log("Assertion failed"),console.log("undefined"==typeof t?"":t))}function pBKDF2(e,t,n,s){"use strict";return assert(""!==e,"PBKDF2 password: "+e),assert(""!==t,"PBKDF2 salt: "+t),assert("number"==typeof n,"PBKDF2 numIterations: "+n),assert("number"==typeof s,"PBKDF2 keyLength: "+s),window.crypto&&window.crypto.subtle?new Promise(function(r,a){let o=new TextEncoder("utf-8"),i=o.encode(t),d=o.encode(e);window.crypto.subtle.importKey("raw",d,{name:"PBKDF2"},!1,["deriveBits"]).then(function(e){return window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:n,salt:i,hash:"SHA-1"},e,s)}).then(function(e){r(e)}).catch(function(e){a(e)})}):new Promise(function(r,a){let o=CryptoJS.PBKDF2(e,t,{iterations:n,keySize:s/32});r(o)})}function hMACSHA256(e,t){"use strict";return window.crypto&&window.crypto.subtle?new Promise(function(n,s){let r=new TextEncoder("utf-8"),a=r.encode(e);window.crypto.subtle.importKey("raw",t,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]).then(function(e){return window.crypto.subtle.sign({name:"HMAC",hash:{name:"SHA-256"}},e,a)}).then(function(e){let t=new Uint8Array(e);n(t)})}):new Promise(function(n,s){let r=CryptoJS.HmacSHA256(e,t),a=convertWordArrayToUint8Array(r);n(a)})}function aesEncrypt(e,t){"use strict";return window.crypto&&window.crypto.subtle?new Promise(function(n,s){let r=new TextEncoder("utf-8"),a=r.encode(e),o=convertHexToUint8Array(t),i=window.crypto.getRandomValues(new Uint8Array(16));window.crypto.subtle.importKey("raw",o,{name:"AES-CBC",length:128},!1,["encrypt"]).then(function(e){return window.crypto.subtle.encrypt({name:"AES-CBC",iv:i},e,a)}).then(function(e){let t=new Uint8Array(e);n({iv:i,ciphertext:t})})}):new Promise(function(n,s){let r=CryptoJS.AES.encrypt(e,t);n(r)})}function aesDecrypt(e,t){"use strict";return window.crypto&&window.crypto.subtle?new Promise(function(n,s){let r=new TextDecoder("utf-8"),a=convertHexToUint8Array(t);window.crypto.subtle.importKey("raw",a,{name:"AES-CBC",length:128},!1,["decrypt"]).then(function(t){return window.crypto.subtle.decrypt({name:"AES-CBC",iv:e.iv},t,e.ciphertext)}).then(function(e){let t=new Uint8Array(e),s=r.decode(t);n(s)})}):new Promise(function(e,n){let s=CryptoJS.AES.decrypt(encyptedData,t),r=CryptoJS.enc.Utf8.stringify(s);e(r)})}function convertDerivedKeyToHex(e){"use strict";return convertUint8ArrayToHex(window.crypto&&window.crypto.subtle?new Uint8Array(e):convertWordArrayToUint8Array(e))}function convertWordArrayToHex(e){"use strict";return convertUint8ArrayToHex(convertWordArrayToUint8Array(e))}function convertWordArrayToUint8Array(e){"use strict";let t=e.words,n=e.sigBytes,s=new Uint8Array(n);for(let r=0;r<n;r++){let e=t[r>>>2]>>>24-r%4*8&255;s[r]=e}return s}function convertUint8ArrayToHex(e){let t,n,s,r="";for(t=0,n=e.length;t<n;t+=1)s=e[t].toString(16),s.length<2&&(s="0"+s),r+=s;return r}function convertHexToUint8Array(e){let t,n,s=e.length/2,r=0;if(s!==parseInt(s,10))throw new Error("Invalid hex length "+e.length);for(n=new Uint8Array(s),t=0;t<s;t+=1)n[t]=parseInt(e[r]+e[r+1],16),r+=2;return n}function zeroVar(e){return Array(e.length).join("0")}function zeroIntArray(e){let t=e;for(let n=0;n<e.length;n++)t[n]=0;return t}function prepServiceWorker(){if(navigator.serviceWorker){navigator.serviceWorker.register("sw.js").then(function(e){if(navigator.serviceWorker.controller)return e.waiting?void updateReady(e.waiting):e.installing?void trackInstalling(e.installing):void e.addEventListener("updatefound",function(){trackInstalling(e.installing)})});let e;navigator.serviceWorker.addEventListener("controllerchange",function(){e||(window.location.reload(),e=!0)})}}function trackInstalling(e){e.addEventListener("statechange",function(){"installed"==e.state&&updateReady(e)})}function updateReady(e){let t=document.getElementById("update-message"),n=document.getElementById("count-down-value"),s=[5,4,3,2,1];t.classList.remove("hidden"),window.setTimeout(function(){e.postMessage({action:"skipWaiting"})},5e3),s.forEach(function(e){window.setTimeout(function(){n.innerText=e},1e3*(5-e))})}function focusFirstUnpopulatedField(){""===r.value.trim()?r.focus():""===o.value.trim()?o.focus():""===s.value.trim()&&s.focus()}function firebaseDataCallback(e){let t=JSON.stringify(e).replace(/--dot--/g,".");C=JSON.parse(t),""!==r.value&&setDomainUserNames(y.prepareDomain(r.value))}function setDomainUserNames(e){if(clearUserNames(),C&&C[e]&&C[e].usernames){let t=C[e].usernames,n=[],s=0,r="",a=!1;Object.keys(t).forEach(function(t){0===t.indexOf(t)&&n.push(t);let a=C[e].usernames[t];Object.keys(a).forEach(function(e){a[e].lastUsed>s&&(s=a[e].lastUsed,r=t)})}),""!==r&&o.value!==r&&(populateValue(o,r),a=!0),loadUserNames(n),a&&""!==o.value&&userNameUpdate()}else""===o.value&&(setType("long-password"),c.value=1)}function setUserNamePasswordTypes(e,t){if(resetPasswordTypesUsed(),C&&C[e]&&C[e].usernames[t]){let n=C[e].usernames[t],s=0,r="";Object.keys(n).forEach(function(e){let t=document.getElementById(e),a=document.getElementById(e+"-tooltip");t&&(t.classList.add("green-text"),a.classList.remove("hidden"),n[e].lastUsed>s&&(s=n[e].lastUsed,a.innerText=relativeDate(n[e].lastUsed),r=e))}),""!==r&&setType(r)}else setType("long-password"),c.value=1}function setUserNamePasswordTypeVersion(e,t,n){if(C&&C[e]&&C[e].usernames[t]){let s=C[e].usernames[t];Object.keys(s).forEach(function(e){if(e===n&&s[e].passwordVersion)return void(c.value=s[e].passwordVersion)})}else c.value=1}function resetPasswordTypesUsed(){for(let e=0;e<d.children.length;e++)"LI"===d.children[e].nodeName?d.children[e].classList.remove("green-text"):d.children[e].classList.add("hidden")}function recordGeneration(e,t,n,s){if(P){let r=P.getUserId(),a=e.replace(/\./g,"--dot--"),o=t.replace(/\./g,"--dot--");r&&firebase.database().ref("users/"+r+"/domains/"+a+"/usernames/"+o+"/"+n).update({passwordVersion:s,lastUsed:Date.now()})}}function populateValue(e,t){try{e.value=t,t.length>0&&e.parentElement.classList.add("is-dirty")}catch(e){console.log("Error populating value: "+e)}}function closeDialog(){let e=document.getElementById("confirm-dialog");clearPassPhraseAndStore(),e.classList.add("hidden")}function checkVersion(){let e=c.value;e=e.replace(/[^0-9]/g,""),""===e?(populateValue(c,"1"),e="1"):e.length>3&&(e=e.substring(0,3)),populateValue(c,e),c.parentElement.classList.remove("is-invalid")}function userNameUpdate(){""!==r.value&&""!==o.value&&setUserNamePasswordTypes(r.value,o.value)}function checkRequired(e){let t=-1;e&&(t=L.indexOf(e)),t==-1&&(t=L.length);for(let n=0;n<t;n++){let e=document.getElementById(L[n]);e&&(e.value&&""!==e.value?e.parentElement.classList.remove("is-invalid"):e.parentElement.classList.add("is-invalid"))}}function sendValsToExt(){g&&storeExtVals()}function openCloseOptions(){}function clearPassword(){hideElement("password-card"),u&&(u.textContent=zeroVar(u.textContent),u.textContent="")}function clearPassPhraseStore(){v.clearStore(),g&&clearExtPhrase(),E=Date.now()}function clearPassPhrase(){s&&(s.value=zeroVar(s.value),s.value=""),clearPassword()}function clearPassPhraseAndStore(){clearPassPhrase(),clearPassPhraseStore(),setPassPhraseScreenState("editing"),s.focus()}function setPassPhrase(e){s.value=e,setPassPhraseScreenState("holding"),passPhraseTimedClear()}function passPhraseTimedClear(){let e;E=Date.now(),e=E,window.setTimeout(function(){e===E&&(clearPassPhrase(),setPassPhraseScreenState("stored"))},3e5)}function passPhraseUpdated(){s.value.length>0&&o.value.length>0?v.encryptPhrase(s.value,o.value.trim()).then(function(e){sendValsToExt()}).catch(function(e){console.log(e)}):(v.clearStore(),sendValsToExt())}function generatePassword(){let e=document.getElementById("password"),t=document.getElementById("error");if(hidePassPhraseDisplayButton(),S&&openCloseOptions(),hideElement("copy-password-div"),isReadyToGenerate()){showElement("password-card"),t.textContent=e.textContent="";let n=s.value,i=r.value.trim(),d=o.value.trim(),u="",h=c.value;"answer"===b&&a.value.trim().length>0&&(u=a.value.trim()),b&&y.generatePassword(d,n,i,b,h,u).then(function(t){clearBodyClasses(),"answer"===b?l.classList.add("ext-answer-generated"):l.classList.add("ext-pass-generated"),e.textContent=t,populateOrCopyPassword(),recordGeneration(i,d,b,h),passPhraseTimedClear(),setPassPhraseScreenState("holding"),window.setTimeout(function(){clearPassword()},3e4)}).catch(function(e){t.textContent=e.message})}}function populateOrCopyPassword(){let e=!1;g?(generateExtPassword(),extHasPassword!==!0||"login"===b||"answer"===b?e=!0:window.setTimeout(function(){showSnackbar(k+" inserted",5,!1)},250)):e=!0,e&&(showElement("copy-password-div"),u.scrollIntoView(),window.setTimeout(function(){copyPasswordToClipboard()},500))}function setPassPhraseScreenState(e){x=e,"editing"===e?(showElement("passphrase-div"),hideElement("confirm-dialog"),hideElement("clear-passphrase"),focusFirstUnpopulatedField()):"holding"===e?(showElement("passphrase-div"),hideElement("confirm-dialog"),focusFirstUnpopulatedField()):"stored"===e?(showElement("confirm-dialog"),window.setTimeout(function(){document.getElementById("confirm-passphrase").focus()},0)):"failed"===e&&(hideElement("confirm-dialog"),showElement("passphrase-div"),showSnackbar("Characters entered don't match the saved pass phrase. Pass phrase cleared.",8,!0),window.setTimeout(function(){setPassPhraseScreenState("editing"),s.focus()},5250))}function checkConfirmation(){let e=document.getElementById("confirm-passphrase");3===e.value.length&&(confirmThreeChars(e.value,o.value.trim()),zeroVar(e.value),e.value="")}function confirmThreeChars(e,t){v.decryptPhrase(e,t).then(function(e){setPassPhrase(e),setPassPhraseScreenState("holding")}).catch(function(e){clearPassPhraseStore(),clearPassPhrase(),setPassPhraseScreenState("failed")})}function isReadyToGenerate(){checkRequired();let e=y.prepareDomain(r.value);return o.value.trim().length>0&&s.value.trim().length>0&&e.length>0&&("answer"!==b||a.value.trim().length>0)}function trimDomainName(){r.value=y.prepareDomain(r.value),""!==r.value&&setDomainUserNames(r.value)}function showElement(e){let t=document.getElementById(e);t&&t.classList.remove("hidden")}function hideElement(e){let t=document.getElementById(e);t&&t.classList.add("hidden")}function clearBodyClasses(){l.classList.remove("ext-pass"),l.classList.remove("ext-answer"),l.classList.remove("ext-pass-generated"),l.classList.remove("ext-answer-generated")}function copyPasswordToClipboard(){let e=document.getElementById("clipboard-value");e.value=u.textContent,e.select();try{document.execCommand("copy")&&showSnackbar(k+" copied to Clipboard",5,!1)}catch(e){hideElement("copy-password-div"),console.log("Copy command failed")}}function chooseType(){setType(this.id)}function setType(e){let t=document.getElementById("generate-password"),n=document.getElementById("copy-password"),s=document.getElementById("password-card-header"),r=document.getElementById("password-type-text");n.textContent="Copy Password",k="Password",s.textContent="Password",t.textContent="Produce password",showElement("user-name-div"),hideElement("security-question-div"),b=e,setUserNamePasswordTypeVersion(domain.value||"",o.value||"",e);let a=document.getElementById("password-selected");switch(e){case"maximum-password":passwordDescription="Maximum password",r.innerText="Maximum password (20 characters)";break;case"long-password":passwordDescription="Long password",r.innerText="Long password (14 characters)";break;case"medium-password":passwordDescription="Medium password",r.innerText="Medium password (8 characters)";break;case"basic-password":passwordDescription="Basic password",r.innerText="Basic password (8 letters / numbers)";break;case"short-password":passwordDescription="Short password",r.innerText="Short password (6 letters / numbers)";break;case"pin":t.textContent="Produce PIN",passwordDescription="Four digit PIN",n.textContent="Copy PIN",k="PIN",s.textContent="PIN",r.innerText="Four digit PIN";break;case"pin-6":t.textContent="Produce PIN",passwordDescription="Six digit PIN",n.textContent="Copy PIN",k="PIN",s.textContent="PIN",r.innerText="Six digit PIN";break;case"answer":t.textContent="Produce security answer",passwordDescription="Security answer",n.textContent="Copy Security Answer",k="Answer",s.textContent="Answer",showElement("security-question-div"),r.innerText="Security answer"}a.parentElement.classList.add("is-dirty"),clearBodyClasses(),"answer"===b?l.classList.add("ext-answer"):l.classList.add("ext-pass"),clearPassword()}function clearUserNames(){let e=document.getElementById("loaded-usernames");for(;e.firstChild;)e.removeChild(e.firstChild);i.classList.add("hidden")}function loadUserNames(e){if(e.length){let t=document.getElementById("loaded-usernames");e.forEach(function(e){let n=document.createElement("li");n.appendChild(document.createTextNode(e)),n.setAttribute("id",e),n.classList.add("mdl-menu__item","menu-dropdown"),t.appendChild(n),n.addEventListener("click",chooseName,!1)}),i.classList.remove("hidden")}""===o.value&&populateValue(o,e[0])}function chooseName(){setUserName(this.id)}function setUserName(e){let t=document.getElementById("loaded-usernames");populateValue(o,e),s.focus(),t.MaterialMenu.hide(),userNameUpdate()}function showPassPhraseDisplayButton(){"editing"===x||"failed"===x?showElement("show-passphrase"):"holding"===x&&showElement("clear-passphrase")}function hidePassPhraseDisplayButton(){hideElement("show-passphrase"),hideElement("clear-passphrase"),s.type="password"}function togglePassPhraseView(){let e=document.getElementById("show-passphrase");"password"===s.type?(s.type="text-area",e.innerHTML='<i class="material-icons">visibility_off</i>'):(s.type="password",e.innerHTML='<i class="material-icons">visibility</i>'),s.focus()}function runTests(){g?window.open("https://mrpeel.github.io/opensesame/test/opensesame-test.html"):window.open("test/opensesame-test.html")}function showSnackbar(e,t,n){let s=document.getElementById("open-sesame-snackbar"),r={message:e,timeout:1e3*t};s.MaterialSnackbar.showSnackbar(r);let a=document.getElementById("open-sesame-snackbar-text");n?a.classList.add("snackbar-error"):a.classList.remove("snackbar-error")}function setPassChangeRequired(){let e;passChangeRequiredCount=2,lastPassPhraseLength=s.value.length,E=Date.now(),e=E,window.setTimeout(function(){e===E&&clearPassPhrase()},18e4)}function changePassPhrase(){clearPassword(),showPassPhraseDisplayButton()}function relativeDate(e){let t=new Date(e),n=new Date,s=(n.getTime()-t.getTime())/1e3,r=Math.floor(s/86400);0===r&&n.getDate()-t.getDate()>0&&(r=1);let a=Math.floor(r/334),o=t.getFullYear(),i=["January","February","March","Aprail","May","June","July","August","September","October","November","December"];return isNaN(r)||r<0||r>31?a>0?i[t.getMonth()]+" "+o:"last "+i[t.getMonth()]:0==r&&s<60?"just now":0==r&&s<120?"a minute ago":0==r&&s<3600?Math.floor(s/60)+" minutes ago":0==r&&s<7200?"an hour ago":0==r?Math.floor(s/7200)+" hours ago":1==r?"yesterday":r<7?r+" days ago":r>=7&&r<10?"a week ago":r<=31?Math.ceil(r/7)+" weeks ago":void 0}function googleSignIn(){P&&(showLoader(),g?returnExtAuthToken().then(function(e){return P.logInWithToken(e)}).then(function(){hideLoader()}).catch(function(e){"auth/invalid-credential"===e.code&&removeExtAuthToken(token),console.log(e),hideLoader()}):P.logIn().catch(function(e){hideLoader(),(e.code="auth/network-request-failed")?showSnackbar("No internet connection",5,!0):(showSnackbar("Cannot connect",5,!0),console.log(error))}))}function googleSignOut(){P&&P.logOut(),closeUserCard()}function firebaseSignInCallback(e){let t=document.getElementById("photo"),n=document.getElementById("card-photo"),s=document.getElementById("display-name"),r=document.getElementById("display-email");p.classList.add("hidden"),h.classList.remove("hidden"),hideLoader(),e.photoURL?(t.src=e.photoURL,t.classList.remove("hidden"),n.src=e.photoURL,n.classList.remove("hidden")):(t.classList.add("hidden"),n.classList.add("hidden")),e.name&&""!==e.name?(s.innerText=e.name,s.classList.remove("hidden")):s.classList.add("hidden"),e.email&&""!==e.email?(r.innerText=e.email,r.classList.remove("hidden")):r.classList.add("hidden")}function firebaseSignOutCallback(){window.setTimeout(function(){p||(p=document.getElementById("sign-in")),h||(h=document.getElementById("signed-in")),hideLoader(),C=null,p.classList.remove("hidden"),h.classList.add("hidden"),closeUserCard()},0)}function closeUserCard(){w||(w=document.getElementById("user-card")),w.classList.add("hidden")}function showLoader(){f||(f=document.getElementById("loader")),f.classList.add("is-active")}function hideLoader(){f||(f=document.getElementById("loader")),f.classList.remove("is-active")}window.pBKDF2=pBKDF2,window.hMACSHA256=hMACSHA256,window.aesEncrypt=aesEncrypt,window.aesDecrypt=aesDecrypt,window.convertDerivedKeyToHex=convertDerivedKeyToHex,window.convertWordArrayToHex=convertWordArrayToHex,window.convertWordArrayToUint8Array=convertWordArrayToUint8Array,window.convertUint8ArrayToHex=convertUint8ArrayToHex,window.convertHexToUint8Array=convertHexToUint8Array,window.zeroVar=zeroVar,window.zeroIntArray=zeroIntArray;class e{constructor(){this.ns="cake.man.io"}encryptPhrase(e,t){assert(""!==e,"TemporaryPhraseStore.prototype.encryptPhrase passphrase: "+e),assert(""!==t,"TemporaryPhraseStore.prototype.encryptPhrase userName: "+t);let n,s=this;return new Promise(function(r,a){if("string"==typeof e&&e.length>=3){let o=e.substring(0,3);pBKDF2(t+o,t+s.ns,500,128).then(function(e){return n=convertDerivedKeyToHex(e),pBKDF2(convertDerivedKeyToHex(e),t+o,250,128)}).then(function(t){return s.threeCharHash=convertDerivedKeyToHex(t),aesEncrypt(e,n)}).then(function(e){s.encData=e,r("Success")}).catch(function(e){a(e)})}else a("Pass phrase must be a sring at least three characters long")})}decryptPhrase(e,t){assert(""!==e,"TemporaryPhraseStore.prototype.decryptPhrase firstThreeChars: "+e),assert(""!==t,"TemporaryPhraseStore.prototype.decryptPhrase name: "+t);let n,s=this;return new Promise(function(r,a){"undefined"==typeof s.encData?a("No encrypted data found"):"string"!=typeof e||3!==e.length?(s.clearStore(),a("First three characters parameter is not a 3 character string")):pBKDF2(t+e,t+s.ns,500,128).then(function(s){return n=convertDerivedKeyToHex(s),pBKDF2(convertDerivedKeyToHex(s),t+e,250,128)}).then(function(e){s.threeCharHash===convertDerivedKeyToHex(e)?aesDecrypt(s.encData,n).then(function(e){r(e)}):(s.clearStore(),a("First three characters did not match"))})})}clearStore(){"undefined"!=typeof this.threeCharHash&&(zeroVar(this.threeCharHash),delete this.threeCharHash),"undefined"!=typeof this.encData&&("string"==typeof this.encData.iv?(zeroVar(this.encData.iv),this.encData.iv=""):"Uint8Array"===this.encData.iv.constructor.name&&(zeroIntArray(this.encData.iv),this.encData.iv=[]),"string"==typeof this.encData.ciphertext?(zeroVar(this.encData.ciphertext),this.encData.ciphertext=""):"Uint8Array"===this.encData.ciphertext.constructor.name&&(zeroIntArray(this.encData.ciphertext),this.encData.ciphertext=[]),delete this.encData)}storeValues(e,t){assert(""!==e,"TemporaryPhraseStore.prototype.storeValues threeCharHash: "+e),assert(""!==t,"TemporaryPhraseStore.prototype.storeValues encData: "+t),this.threeCharHash=e,this.encData=t}}window.TemporaryPhraseStore=e;class t{constructor(){this.keyNS="cake.man.opensesame",this.passwordNS="cake.man.opensesame.password",this.loginNS="cake.man.opensesame.login",this.answerNS="cake.man.opensesame.answer",this.lowerChars="abcdefghijklmnopqrstuvwxyz",this.upperChars="ABCDEFGHIJKLMNOPQRSTUVWXYZ",this.numberChars="0123456789",this.symbolChars="!@#$%^&*()",this.passwordTypes={"maximum-password":{charSet:this.upperChars+this.lowerChars+this.numberChars+this.symbolChars,length:20,needsUpper:!0,needsLower:!0,needsNumber:!0,needsSymbol:!0},"long-password":{charSet:this.upperChars+this.lowerChars+this.numberChars+this.symbolChars,length:14,needsUpper:!0,needsLower:!0,needsNumber:!0,needsSymbol:!0},"medium-password":{charSet:this.upperChars+this.lowerChars+this.numberChars+this.symbolChars,length:8,needsUpper:!0,needsLower:!0,needsNumber:!0,needsSymbol:!0},"basic-password":{charSet:this.upperChars+this.lowerChars+this.numberChars,length:8,needsUpper:!0,needsLower:!0,needsNumber:!0},"short-password":{charSet:this.upperChars+this.lowerChars+this.numberChars,length:6,needsUpper:!0,needsLower:!0,needsNumber:!0},pin:{charSet:this.numberChars,length:4},"pin-6":{charSet:this.numberChars,length:6},answer:{charSet:this.lowerChars,length:16,spaces:[3,6,12]}},this.countryTLDs=["ac","ad","ae","af","ag","ai","al","am","an","ao","aq","ar","as","at","au","aw","ax","az","ba","bb","bd","be","bf","bg","bh","bi","bj","bm","bn","bo","br","bs","bt","bv","bw","by","bz","ca","cc","cd","cf","cg","ch","ci","ck","cl","cm","cn","co","cr","cs","cu","cv","cw","cx","cy","cz","dd","de","dj","dk","dm","do","dz","ec","ee","eg","eh","er","es","et","eu","fi","fj","fk","fm","fo","fr","ga","gb","gd","ge","gf","gg","gh","gi","gl","gm","gn","gp","gq","gr","gs","gt","gu","gw","gy","hk","hm","hn","hr","ht","hu","id","ie","il","im","in","iq","ir","is","it","je","jm","jo","jp","ke","kg","kh","ki","km","kn","kp","kr","kw","ky","kz","la","lb","lc","li","lk","lr","ls","lt","lu","lv","ly","ma","mc","md","me","mg","mh","mk","ml","mm","mn","mo","mp","mq","mr","ms","mt","mu","mv","mw","mx","my","mz","na","nc","ne","nf","ng","ni","nl","no","np","nr","nu","nz","om","pa","pe","pf","pg","ph","pk","pl","pm","pn","pr","ps","pt","pw","py","qa","re","ro","rs","ru","rw","sa","sb","sc","sd","se","sg","sh","si","sj","sk","sl","sm","sn","so","sr","ss","st","su","sv","sx","sy","sz","tc","td","tf","tg","th","tj","tk","tl","tm","tn","to","tp","tr","tt","tv","tw","tz","ua","ug","uk","us","uy","uz","va","vc","ve","vg","vi","vn","vu","wf","ws","ye","yt","yu","za","zm","zw"]}prepareDomain(e){let t,n=0,s="",r="",a=this,o=e.trim().replace(/^https?:\/\//g,"").toLowerCase();return n=o.indexOf("/"),n>0&&(o=o.substr(0,n)),t=o.split("."),t.length>1&&a.countryTLDs.indexOf(t[t.length-1])>=0&&(r="."+t[t.length-1],t=t.slice(0,-1)),t.length>2&&(t=t.slice(-2)),s=t.join(".")+r}prepareUserName(e){return e.trim().toLowerCase()}prepareSecurityQuestion(e){return e.replace(/[.,-\/#!$%\^&\*;:{}=\-_`~()?''"?]/g,"").replace(/  +/g," ").trim().toLowerCase()}generatePassword(e,t,n,s,r,a){let o="",i=r||1,d=a||"";if(!t||0===t.length)return Promise.reject(new Error("Passphrase not present"));if(!n||0===n.length)return Promise.reject(new Error("Domain name not present"));if(!e||0===e.length)return Promise.reject(new Error("User name not present"));if(!s||0===s.length)return Promise.reject(new Error("Password type not present"));if(s&&"answer"===s&&0===a.length)return Promise.reject(new Error("Security question not present"));try{let r=this;return new Promise(function(a,c){o=r.passwordNS,"answer"===s?o=r.answerNS:"login"==s&&(o=r.loginNS);let l=r.prepareUserName(e),u=o+"."+l,h=r.prepareDomain(n);h=l+i+"@"+h,"answer"===s&&(d=r.prepareSecurityQuestion(d),h=h+":"+d),pBKDF2(t,u,750,128).then(function(e){return hMACSHA256(h,e)}).then(function(e){let n=r.passwordTypes[s].length,o=n-1,i=r.passwordTypes[s].spaces||[],d=r.passwordTypes[s].charSet,c="",l=r.passwordTypes[s].needsUpper||!1,u=r.passwordTypes[s].needsLower||!1,h=r.passwordTypes[s].needsNumber||!1,p=r.passwordTypes[s].needsSymbol||!1,m=e[0]%o,w=m+1,f=m+2,g=m+3;for(let y=0;y<e.length;y++){let t;y<n&&(t=i.indexOf(y)>=0?" ":l&&y===m%o?r.upperChars[e[y]%(r.upperChars.length-1)]:u&&y===w%o?r.lowerChars[e[y]%(r.lowerChars.length-1)]:h&&y===f%o?r.numberChars[e[y]%(r.numberChars.length-1)]:p&&y===g%o?r.symbolChars[e[y]%(r.symbolChars.length-1)]:d[e[y]%(d.length-1)],c+=t,r.upperChars.indexOf(t)>=0?l=!1:r.lowerChars.indexOf(t)>=0?u=!1:r.numberChars.indexOf(t)>=0?h=!1:r.symbolChars.indexOf(t)>=0&&(p=!1)),e[y]=0}t=zeroVar(t),a(c)}).catch(function(e){return Promise.reject(e)})})}catch(e){return Promise.reject(e)}}}window.OpenSesame=t;class n{constructor(e,t,n,s){let r=this,a={apiKey:"AIzaSyCQmNa81aSqSBHExjDXKWkx2uDoAMPexOw",authDomain:"open-sesame-f1f51.firebaseapp.com",databaseURL:"https://open-sesame-f1f51.firebaseio.com"};firebase.initializeApp(a),r.uid=null,r.photoURL=null,r.name=null,r.email=null,r.signInCallback=e||null,r.signOutCallback=t||null,r.childAddedCallback=n||null,r.childChangedCallback=s||null,firebase.auth().onAuthStateChanged(function(e){if(e){r.uid=e.uid,r.photoURL=e.photoURL||null,r.name=e.displayName,r.email=e.email;let t=firebase.database().ref("users/"+e.uid);r.childAddedCallback&&t.on("child_added",function(e){r.childAddedCallback(e.val())}),r.childChangedCallback&&t.on("child_changed",function(e){r.childChangedCallback(e.val())}),r.signInCallback&&r.signInCallback({userId:r.uid,photoURL:r.photoURL,name:r.name,email:r.email})}else r.uid=null,r.photoURL=null,r.name=null,r.email=null,r.signOutCallback&&r.signOutCallback()})}logIn(){if(!firebase.auth().currentUser){let e=new firebase.auth.GoogleAuthProvider;return firebase.auth().signInWithRedirect(e)}}logInWithToken(e){if(!firebase.auth().currentUser){let t=firebase.auth.GoogleAuthProvider.credential(null,e);return firebase.auth().signInWithCredential(t)}}isAuthenticated(){return new Promise(function(e,t){firebase.auth().getRedirectResult().then(function(t){e(!0)}).catch(function(e){t(e)})})}getUserId(){let e=this;return e.uid?e.uid:null}getUserPhotoURL(){let e=this;return e.uid&&e.photoURL?e.photoURL:null}logOut(){firebase.auth().currentUser&&firebase.auth().signOut()}}window.FBAuth=n,window.prepServiceWorker=prepServiceWorker,window.changePassPhrase=changePassPhrase,window.setPassChangeRequired=setPassChangeRequired;let s,r,a,o,i,d,c,l,u,h,p,m,w,f,g,y,v,P,b,C,E,k,x,S=!1,L=["domain","user-name","passphrase"];window.addEventListener("load",function(){window.applicationCache.addEventListener("updateready",function(e){window.applicationCache.status==window.applicationCache.UPDATEREADY&&window.location.reload()},!1),y=new t,v=new e,r=document.getElementById("domain"),o=document.getElementById("user-name"),i=document.getElementById("username-dropdown"),s=document.getElementById("passphrase"),a=document.getElementById("security-question"),d=document.getElementById("type"),l=document.querySelector("body"),u=document.getElementById("password"),c=document.getElementById("version"),p=document.getElementById("sign-in"),h=document.getElementById("signed-in"),m=document.getElementById("sign-out"),w=document.getElementById("user-card"),f=document.getElementById("loader"),r.addEventListener("input",function(){checkRequired("domain"),clearPassword()},!1),o.addEventListener("input",function(){checkRequired("user-name"),clearPassword()},!1),s.addEventListener("input",function(){checkRequired("passphrase"),clearPassword()},!1),a.addEventListener("input",function(){checkRequired(),clearPassword()},!1),c.addEventListener("input",function(){checkRequired(),clearPassword()},!1),c.addEventListener("blur",checkVersion,!1),s.addEventListener("focus",showPassPhraseDisplayButton,!1),s.addEventListener("blur",passPhraseUpdated,!1),document.getElementById("confirm-passphrase").addEventListener("input",checkConfirmation,!1),o.addEventListener("focus",hidePassPhraseDisplayButton,!1),o.addEventListener("blur",function(){userNameUpdate(),sendValsToExt()},!1),r.addEventListener("focus",hidePassPhraseDisplayButton,!1),r.addEventListener("blur",function(){trimDomainName(),sendValsToExt()},!1),a.addEventListener("focus",hidePassPhraseDisplayButton,!1),a.addEventListener("blur",sendValsToExt,!1);for(let g=0;g<d.children.length;g++)"LI"===d.children[g].nodeName&&d.children[g].addEventListener("click",chooseType,!1);document.getElementById("header-key").addEventListener("click",runTests,!1),document.getElementById("clear-passphrase").addEventListener("click",clearPassPhraseAndStore,!1),document.getElementById("show-passphrase").addEventListener("click",togglePassPhraseView,!1),document.getElementById("generate-password").addEventListener("click",generatePassword,!1),document.getElementById("copy-password").addEventListener("click",copyPasswordToClipboard,!1),document.getElementById("close-password").addEventListener("click",clearPassword,!1),document.getElementById("clear-close-dialog").addEventListener("click",closeDialog,!1),document.getElementById("close-password-confirm").addEventListener("click",closeDialog,!1),h.addEventListener("click",function(){w.classList.remove("hidden")},!1),p.addEventListener("click",googleSignIn,!1),m.addEventListener("click",googleSignOut,!1),r.disabled=!1,o.disabled=!1,s.disabled=!1,d.disabled=!1,focusFirstUnpopulatedField(),void 0===x&&setPassPhraseScreenState("editing"),void 0===b&&window.setTimeout(function(){setType("long-password")});try{P=new n(firebaseSignInCallback,firebaseSignOutCallback,firebaseDataCallback,firebaseDataCallback),P.getUserId()||firebaseSignOutCallback()}catch(e){console.log("Cannot create firebase object"),console.log(e)}},!1);